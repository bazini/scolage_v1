<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.14  |
    |              on 2024-09-11 13:11:16              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*

*/
 defined("\102\101\x53\x45\120\x41\124\110") or exit("\116\157\x20\x64\151\x72\x65\x63\164\40\x73\143\x72\151\160\164\40\x61\143\143\x65\x73\x73\40\x61\x6c\154\x6f\167\x65\x64"); class CI_Security { public $filename_bad_chars = array("\56\56\x2f", "\74\41\x2d\55", "\x2d\x2d\x3e", "\74", "\x3e", "\47", "\x22", "\x26", "\x24", "\43", "\x7b", "\x7d", "\133", "\x5d", "\75", "\73", "\77", "\45\x32\x30", "\45\62\62", "\45\63\x63", "\x25\62\65\63\143", "\45\63\145", "\45\x30\145", "\45\62\x38", "\45\x32\71", "\x25\x32\x35\x32\x38", "\45\x32\x36", "\x25\x32\64", "\x25\x33\146", "\45\63\142", "\x25\63\144"); public $charset = "\125\124\106\x2d\x38"; protected $_xss_hash; protected $_csrf_hash; protected $_csrf_expire = 7200; protected $_csrf_token_name = "\143\151\137\x63\163\x72\x66\x5f\x74\x6f\x6b\x65\x6e"; protected $_csrf_cookie_name = "\143\151\137\143\x73\162\x66\x5f\164\157\153\x65\156"; protected $_never_allowed_str = array("\144\x6f\x63\x75\x6d\x65\156\164\56\x63\x6f\x6f\153\151\x65" => "\x5b\x72\x65\155\157\x76\x65\x64\x5d", "\x28\x64\157\143\x75\x6d\145\x6e\x74\x29\x2e\143\x6f\157\153\151\145" => "\133\x72\145\x6d\157\x76\145\x64\x5d", "\144\157\143\165\155\x65\x6e\164\56\x77\x72\x69\164\145" => "\133\x72\145\155\157\166\145\144\135", "\50\144\x6f\x63\165\x6d\x65\156\164\x29\x2e\167\x72\x69\164\145" => "\x5b\x72\145\x6d\x6f\166\145\144\135", "\x2e\160\x61\162\145\156\164\x4e\157\x64\145" => "\x5b\162\145\x6d\157\166\x65\x64\x5d", "\x2e\151\x6e\x6e\145\162\x48\x54\115\x4c" => "\133\x72\145\155\x6f\166\145\144\x5d", "\x2d\155\x6f\x7a\x2d\142\151\x6e\144\151\156\x67" => "\133\162\145\x6d\x6f\166\145\144\135", "\74\x21\55\x2d" => "\x26\x6c\164\73\41\x2d\x2d", "\x2d\55\76" => "\55\55\46\x67\164\x3b", "\74\41\x5b\103\104\x41\124\101\x5b" => "\x26\154\164\73\41\133\x43\x44\101\x54\101\x5b", "\74\x63\x6f\155\155\145\156\164\76" => "\46\x6c\x74\x3b\x63\157\x6d\155\x65\x6e\164\x26\147\164\x3b", "\74\45" => "\46\154\164\73\x26\x23\x33\67\73"); protected $_never_allowed_regex = array("\x6a\x61\x76\x61\x73\143\162\151\x70\x74\134\163\52\72", "\50\134\x28\77\144\157\143\165\155\x65\156\164\x5c\51\x3f\x7c\x5c\x28\77\x77\x69\156\x64\157\167\x5c\x29\77\x28\134\x2e\x64\x6f\143\x75\x6d\145\156\x74\51\77\51\x5c\x2e\50\x6c\157\x63\x61\x74\151\x6f\x6e\x7c\x6f\156\134\167\52\x29", "\145\170\160\162\x65\163\163\151\157\156\x5c\163\52\x28\134\x28\x7c\46\134\43\64\x30\73\x29", "\166\x62\163\143\x72\151\160\x74\134\x73\52\72", "\167\163\143\162\x69\x70\164\x5c\x73\x2a\x3a", "\x6a\163\143\162\x69\160\164\x5c\x73\52\72", "\166\142\x73\x5c\x73\x2a\x3a", "\122\145\144\151\162\x65\143\164\x5c\x73\x2b\x33\60\x5c\144", "\x28\133\42\x27\135\51\x3f\x64\141\164\x61\134\163\52\x3a\133\x5e\134\61\x5d\x2a\x3f\142\x61\163\145\66\64\133\136\134\61\135\52\x3f\54\133\x5e\134\x31\135\x2a\x3f\134\61\77"); public function __construct() { goto kUAS8; Vnzcs: log_message("\x69\x6e\x66\x6f", "\123\145\143\165\x72\x69\x74\171\40\x43\154\x61\163\x73\40\111\156\x69\164\151\x61\x6c\x69\172\145\144"); goto ZRDKg; yBpW1: $this->charset = strtoupper(config_item("\x63\x68\x61\162\163\x65\x74")); goto Vnzcs; kUAS8: if (config_item("\143\x73\162\146\x5f\x70\x72\157\x74\145\143\164\151\x6f\x6e")) { goto p0X4K; lHrb0: if ($cookie_prefix = config_item("\x63\157\157\153\151\145\137\x70\x72\145\146\151\170")) { $this->_csrf_cookie_name = $cookie_prefix . $this->_csrf_cookie_name; } goto jr0a8; jr0a8: $this->_csrf_set_hash(); goto A1f2V; p0X4K: foreach (array("\143\x73\162\146\x5f\145\170\160\x69\162\145", "\x63\163\162\146\x5f\x74\157\153\145\x6e\x5f\156\141\x6d\145", "\143\x73\x72\x66\137\x63\157\157\x6b\151\145\137\x6e\x61\x6d\x65") as $key) { if (NULL !== ($val = config_item($key))) { $this->{"\x5f" . $key} = $val; } } goto lHrb0; A1f2V: } goto yBpW1; ZRDKg: } public function csrf_verify() { goto dZh0H; cwxcr: unset($_POST[$this->_csrf_token_name]); goto TwRGG; IgbCS: $valid = isset($_POST[$this->_csrf_token_name], $_COOKIE[$this->_csrf_cookie_name]) && is_string($_POST[$this->_csrf_token_name]) && is_string($_COOKIE[$this->_csrf_cookie_name]) && hash_equals($_POST[$this->_csrf_token_name], $_COOKIE[$this->_csrf_cookie_name]); goto cwxcr; T0Uo_: $this->csrf_set_cookie(); goto yklPk; yklPk: if ($valid !== TRUE) { $this->csrf_show_error(); } goto Fv_Ud; Fv_Ud: log_message("\151\x6e\x66\157", "\103\x53\122\x46\x20\164\x6f\153\145\156\40\166\145\162\x69\146\x69\145\144"); goto hUgJ0; xDwH5: if ($exclude_uris = config_item("\x63\163\x72\146\x5f\x65\x78\143\x6c\165\144\x65\137\x75\162\151\x73")) { $uri = load_class("\x55\x52\x49", "\x63\x6f\162\145"); foreach ($exclude_uris as $excluded) { if (preg_match("\x23\x5e" . $excluded . "\44\43\151" . (UTF8_ENABLED ? "\165" : ''), $uri->uri_string())) { return $this; } } } goto IgbCS; TwRGG: if (config_item("\x63\163\162\146\137\x72\145\x67\145\x6e\145\162\141\164\x65")) { unset($_COOKIE[$this->_csrf_cookie_name]); $this->_csrf_hash = NULL; } goto uZLZM; hUgJ0: return $this; goto aaxnG; uZLZM: $this->_csrf_set_hash(); goto T0Uo_; dZh0H: if (strtoupper($_SERVER["\x52\x45\x51\125\105\123\x54\x5f\115\x45\124\110\117\x44"]) !== "\x50\117\123\124") { return $this->csrf_set_cookie(); } goto xDwH5; aaxnG: } public function csrf_set_cookie() { goto R8a_R; GUEZR: setcookie($this->_csrf_cookie_name, $this->_csrf_hash, $expire, config_item("\x63\157\x6f\x6b\151\145\137\x70\x61\x74\150"), config_item("\x63\157\x6f\153\x69\x65\x5f\144\x6f\155\x61\151\156"), $secure_cookie, config_item("\143\x6f\157\x6b\x69\x65\137\150\164\x74\160\157\x6e\154\x79")); goto iXYyf; iXYyf: log_message("\151\x6e\x66\157", "\x43\123\x52\x46\40\143\157\x6f\x6b\151\x65\40\x73\x65\156\x74"); goto sCsJU; R8a_R: $expire = time() + $this->_csrf_expire; goto l_3f3; sCsJU: return $this; goto B6ezu; KbhYM: if ($secure_cookie && !is_https()) { return FALSE; } goto GUEZR; l_3f3: $secure_cookie = (bool) config_item("\143\x6f\x6f\153\151\145\x5f\163\x65\x63\x75\162\x65"); goto KbhYM; B6ezu: } public function csrf_show_error() { show_error("\x54\x68\145\40\x61\x63\164\151\x6f\156\40\x79\x6f\x75\40\x68\141\x76\145\x20\162\x65\161\x75\145\163\x74\x65\144\40\x69\x73\x20\156\x6f\x74\x20\141\154\154\x6f\x77\145\144\x2e", 403); } public function get_csrf_hash() { return $this->_csrf_hash; } public function get_csrf_token_name() { return $this->_csrf_token_name; } public function xss_clean($str, $is_image = FALSE) { goto ul4R1; fEMY0: if (stripos($str, "\x25") !== false) { do { $oldstr = $str; $str = rawurldecode($str); $str = preg_replace_callback("\43\45\x28\77\72\x5c\x73\52\133\x30\x2d\71\141\x2d\x66\x5d\51\x7b\62\x2c\x7d\43\x69", array($this, "\x5f\x75\x72\154\x64\x65\x63\157\144\145\163\x70\141\143\145\x73"), $str); } while ($oldstr !== $str); unset($oldstr); } goto b9HBi; X7qJu: do { $original = $str; if (preg_match("\x2f\x3c\x61\57\151", $str)) { $str = preg_replace_callback("\43\74\141\50\x3f\x3a\x72\x65\x61\x29\77\x5b\x5e\x61\x2d\172\60\55\71\76\x5d\53\x28\x5b\136\x3e\x5d\52\x3f\x29\50\77\x3a\76\174\44\x29\x23\x73\151", array($this, "\137\x6a\x73\137\154\x69\x6e\x6b\137\x72\x65\155\x6f\166\141\154"), $str); } if (preg_match("\x2f\x3c\151\155\147\57\x69", $str)) { $str = preg_replace_callback("\x23\74\x69\155\x67\x5b\136\x61\55\x7a\60\55\71\x5d\x2b\50\133\x5e\76\x5d\52\77\51\50\x3f\x3a\134\163\x3f\57\77\76\x7c\44\51\43\x73\x69", array($this, "\x5f\x6a\163\137\151\155\147\x5f\x72\145\155\157\166\141\x6c"), $str); } if (preg_match("\x2f\x73\143\x72\x69\160\x74\174\x78\163\163\x2f\151", $str)) { $str = preg_replace("\x23\74\57\52\50\77\72\163\143\x72\151\x70\x74\174\x78\x73\x73\x29\56\x2a\77\76\43\163\151", "\133\x72\x65\155\157\166\145\x64\135", $str); } } while ($original !== $str); goto hipp4; vok2a: $str = $this->_do_never_allowed($str); goto nyybx; BbOlx: foreach ($words as $word) { $word = implode("\134\x73\52", str_split($word)) . "\134\x73\x2a"; $str = preg_replace_callback("\x23\x28" . substr($word, 0, -3) . "\51\50\134\x57\x29\43\151\x73", array($this, "\x5f\143\x6f\155\160\141\x63\164\137\145\x78\x70\x6c\157\x64\x65\x64\x5f\167\157\162\144\163"), $str); } goto X7qJu; IZbZ_: $str = preg_replace("\x23\x28\x61\x6c\x65\162\164\x7c\x70\x72\x6f\155\x70\x74\x7c\x63\157\156\146\151\x72\x6d\174\x63\155\x64\174\x70\x61\x73\x73\x74\150\162\x75\x7c\145\x76\x61\x6c\174\x65\x78\x65\143\174\145\x78\160\x72\145\163\x73\x69\157\156\x7c\x73\171\x73\164\145\155\174\146\x6f\160\x65\x6e\174\x66\163\157\143\x6b\157\x70\145\x6e\174\x66\151\x6c\145\174\x66\151\154\145\137\x67\x65\164\x5f\143\x6f\x6e\164\145\x6e\x74\163\x7c\x72\x65\x61\x64\146\151\154\145\174\x75\x6e\154\x69\156\x6b\x29\x28\134\163\x2a\x29\140\x28\56\x2a\77\x29\x60\43\163\151", "\x5c\61\134\x32\x26\x23\x39\66\73\134\63\x26\x23\71\x36\73", $str); goto vok2a; b9HBi: $str = preg_replace_callback("\x2f\133\x5e\141\x2d\172\x30\55\71\x3e\135\53\x5b\141\x2d\x7a\60\x2d\71\135\53\x3d\x28\133\x5c\47\x22\x5d\x29\56\x2a\x3f\134\61\x2f\x73\151", array($this, "\137\143\157\156\166\145\162\x74\x5f\x61\164\x74\x72\151\x62\165\164\145"), $str); goto NRvcd; BE_XV: $converted_string = $str; goto c2ney; Ri3BS: $words = array("\152\141\166\141\x73\143\162\151\x70\164", "\145\170\160\x72\145\163\x73\151\157\156", "\166\x62\x73\x63\x72\x69\x70\x74", "\x6a\163\x63\162\x69\x70\x74", "\x77\163\143\x72\x69\160\x74", "\166\142\x73", "\163\143\162\151\x70\x74", "\x62\141\163\145\66\x34", "\x61\160\160\x6c\145\x74", "\141\154\145\x72\164", "\144\157\x63\x75\x6d\145\x6e\x74", "\x77\162\151\x74\145", "\x63\x6f\x6f\153\x69\x65", "\x77\x69\x6e\144\157\x77", "\x63\x6f\x6e\146\x69\x72\x6d", "\x70\162\157\x6d\x70\164", "\x65\166\x61\154"); goto BbOlx; ul4R1: if (is_array($str)) { foreach ($str as $key => &$value) { $str[$key] = $this->xss_clean($value); } return $str; } goto IDbCr; doGqy: $str = preg_replace("\x23\x28\141\154\145\162\164\174\x70\x72\x6f\155\x70\164\174\x63\x6f\156\146\151\x72\155\174\x63\x6d\144\174\160\141\163\x73\164\x68\162\x75\x7c\x65\x76\141\x6c\x7c\x65\170\x65\143\x7c\x65\x78\160\162\145\163\163\151\x6f\x6e\174\163\x79\163\x74\x65\x6d\174\x66\157\x70\x65\156\x7c\x66\163\x6f\143\x6b\x6f\x70\145\x6e\174\146\x69\154\145\x7c\x66\x69\x6c\145\137\147\145\x74\x5f\x63\157\x6e\x74\145\x6e\x74\163\x7c\x72\145\x61\144\146\x69\154\x65\x7c\165\x6e\154\x69\x6e\153\51\x28\134\163\52\51\134\50\50\x2e\x2a\x3f\51\x5c\51\x23\x73\x69", "\x5c\61\134\62\46\43\64\60\x3b\x5c\63\x26\43\64\61\x3b", $str); goto IZbZ_; oDaJd: return $str; goto kNb6H; PLnOj: do { $old_str = $str; $str = preg_replace_callback($pattern, array($this, "\x5f\163\141\156\x69\x74\x69\x7a\145\137\156\141\165\x67\150\x74\x79\137\150\164\155\154"), $str); } while ($old_str !== $str); goto RpK9s; qTuDi: if ($is_image === TRUE) { $str = preg_replace("\57\74\x5c\x3f\x28\160\x68\160\51\57\151", "\46\x6c\x74\73\77\x5c\61", $str); } else { $str = str_replace(array("\74\x3f", "\x3f" . "\x3e"), array("\x26\154\x74\73\77", "\x3f\46\x67\164\73"), $str); } goto Ri3BS; IDbCr: $str = remove_invisible_characters($str); goto fEMY0; NRvcd: $str = preg_replace_callback("\57\x3c\x5c\x77\53\56\52\57\163\x69", array($this, "\x5f\144\x65\x63\157\144\145\x5f\x65\156\x74\x69\164\171"), $str); goto ctVdR; igE8b: $pattern = "\43" . "\x3c\50\50\x3f\x3c\x73\154\x61\x73\150\x3e\57\x2a\134\x73\x2a\51\50\x28\x3f\x3c\164\x61\x67\116\x61\155\145\76\133\x61\x2d\172\x30\x2d\x39\x5d\x2b\51\50\x3f\x3d\133\x5e\141\x2d\x7a\60\x2d\x39\135\x7c\44\51\174\x2e\x2b\51" . "\x5b\x5e\134\x73\x5c\60\x34\62\134\x30\x34\67\141\55\x7a\x30\55\x39\76\x2f\x3d\x5d\x2a" . "\x28\77\74\141\164\x74\x72\151\x62\165\x74\x65\163\x3e\x28\x3f\72\133\134\163\x5c\x30\x34\62\x5c\x30\x34\67\x2f\75\135\x2a" . "\x5b\x5e\x5c\x73\134\60\64\x32\x5c\x30\x34\67\x3e\x2f\75\x5d\53" . "\50\77\x3a\x5c\163\x2a\x3d" . "\50\x3f\72\x5b\136\x5c\x73\x5c\60\64\x32\134\60\64\67\75\76\74\x60\135\x2b\x7c\x5c\x73\x2a\x5c\60\64\62\133\x5e\x5c\x30\x34\x32\x5d\x2a\x5c\x30\64\62\174\134\163\52\x5c\60\64\x37\x5b\x5e\x5c\x30\x34\67\x5d\52\134\60\64\x37\174\134\163\x2a\50\x3f\125\x3a\133\x5e\134\x73\x5c\x30\64\62\x5c\60\64\67\75\x3e\74\x60\135\52\51\x29" . "\x29\77" . "\51\52\x29" . "\133\136\76\x5d\52\51\50\x3f\x3c\x63\x6c\x6f\x73\145\124\x61\147\x3e\134\x3e\51\x3f\43\151\x73\x53"; goto PLnOj; nyybx: if ($is_image === TRUE) { return $str === $converted_string; } goto oDaJd; c2ney: $str = $this->_do_never_allowed($str); goto qTuDi; eIH0i: $str = str_replace("\x9", "\x20", $str); goto BE_XV; hipp4: unset($original); goto igE8b; RpK9s: unset($old_str); goto doGqy; ctVdR: $str = remove_invisible_characters($str); goto eIH0i; kNb6H: } public function xss_hash() { if ($this->_xss_hash === NULL) { $rand = $this->get_random_bytes(16); $this->_xss_hash = $rand === FALSE ? md5(uniqid(mt_rand(), TRUE)) : bin2hex($rand); } return $this->_xss_hash; } public function get_random_bytes($length) { goto C819V; FZcxR: return FALSE; goto R3NsS; iWb4K: if (defined("\115\103\x52\131\120\124\137\104\105\x56\x5f\x55\122\101\x4e\104\117\115") && ($output = mcrypt_create_iv($length, MCRYPT_DEV_URANDOM)) !== FALSE) { return $output; } goto Oayf3; C819V: if (empty($length) or !ctype_digit((string) $length)) { return FALSE; } goto CxQar; Oayf3: if (is_readable("\x2f\x64\145\x76\57\x75\162\141\x6e\x64\157\x6d") && ($fp = fopen("\57\x64\x65\166\x2f\165\162\x61\x6e\x64\x6f\x6d", "\x72\x62")) !== FALSE) { goto S0Okz; apYa8: if ($output !== FALSE) { return $output; } goto evxad; P6PhI: fclose($fp); goto apYa8; S0Okz: is_php("\65\x2e\64") && stream_set_chunk_size($fp, $length); goto nbsBB; nbsBB: $output = fread($fp, $length); goto P6PhI; evxad: } goto XJcXv; XJcXv: if (function_exists("\157\x70\x65\156\163\x73\154\x5f\162\141\156\x64\157\155\137\x70\x73\145\x75\x64\157\x5f\x62\x79\164\x65\x73")) { return openssl_random_pseudo_bytes($length); } goto FZcxR; CxQar: if (function_exists("\x72\x61\156\144\157\155\x5f\x62\171\164\145\x73")) { try { return random_bytes((int) $length); } catch (Exception $e) { log_message("\145\x72\162\x6f\x72", $e->getMessage()); return FALSE; } } goto iWb4K; R3NsS: } public function entity_decode($str, $charset = NULL) { goto fdjZ8; d7U9e: return $str; goto MCKxv; E09OA: do { $str_compare = $str; if (preg_match_all("\x2f\x26\x5b\x61\x2d\172\x5d\x7b\x32\x2c\x7d\50\77\x21\133\x61\x2d\172\73\135\51\57\x69", $str, $matches)) { goto RjcZb; RjcZb: $replace = array(); goto rNkeM; FojtY: $str = str_replace(array_keys($replace), array_values($replace), $str); goto Y27Zh; rNkeM: $matches = array_unique(array_map("\163\164\162\164\x6f\154\x6f\x77\145\162", $matches[0])); goto mgAH1; mgAH1: foreach ($matches as &$match) { if (($char = array_search($match . "\x3b", $_entities, TRUE)) !== FALSE) { $replace[$match] = $char; } } goto FojtY; Y27Zh: } $str = html_entity_decode(preg_replace("\x2f\50\x26\43\50\x3f\x3a\x78\x30\x2a\133\x30\55\71\x61\55\x66\135\x7b\x32\54\x35\x7d\50\x3f\41\133\60\55\71\x61\x2d\x66\x3b\135\x29\x7c\x28\77\72\x30\x2a\x5c\144\x7b\x32\54\64\175\50\x3f\x21\x5b\60\55\x39\x3b\135\51\51\x29\x29\57\x69\123", "\x24\x31\73", $str), $flag, $charset); if ($flag === ENT_COMPAT) { $str = str_replace(array_values($_entities), array_keys($_entities), $str); } } while ($str_compare !== $str); goto d7U9e; W9OXe: static $_entities; goto j4tUm; fdjZ8: if (strpos($str, "\46") === FALSE) { return $str; } goto W9OXe; prizV: if (!isset($_entities)) { $_entities = array_map("\x73\164\162\164\157\154\157\x77\x65\x72", get_html_translation_table(HTML_ENTITIES, $flag, $charset)); if ($flag === ENT_COMPAT) { goto V26x2; X9Uck: $_entities["\x28"] = "\46\x6c\x70\x61\162\73"; goto h8OqW; h8OqW: $_entities["\51"] = "\x26\x72\x70\141\162\73"; goto abuqO; abuqO: $_entities["\12"] = "\x26\x4e\145\x77\x4c\x69\x6e\x65\73"; goto QtX3V; QtX3V: $_entities["\11"] = "\x26\124\x61\142\73"; goto P64Gm; V26x2: $_entities["\x3a"] = "\46\x63\157\154\157\156\73"; goto X9Uck; P64Gm: } } goto E09OA; j4tUm: isset($charset) or $charset = $this->charset; goto hlbIY; hlbIY: $flag = is_php("\x35\x2e\x34") ? ENT_COMPAT | ENT_HTML5 : ENT_COMPAT; goto prizV; MCKxv: } public function sanitize_filename($str, $relative_path = FALSE) { goto oWzqD; QTK8N: $str = remove_invisible_characters($str, FALSE); goto KnWjX; SsUIj: return stripslashes($str); goto L1Fwg; oWzqD: $bad = $this->filename_bad_chars; goto yVba1; KnWjX: do { $old = $str; $str = str_replace($bad, '', $str); } while ($old !== $str); goto SsUIj; yVba1: if (!$relative_path) { $bad[] = "\56\x2f"; $bad[] = "\57"; } goto QTK8N; L1Fwg: } public function strip_image_tags($str) { return preg_replace(array("\43\x3c\x69\x6d\147\x5b\134\x73\x2f\135\x2b\x2e\x2a\77\163\162\x63\134\x73\52\x3d\134\x73\x2a\x28\133\42\47\135\x29\50\x5b\136\x5c\61\135\x2b\77\x29\134\x31\56\x2a\x3f\x5c\76\x23\x69", "\43\x3c\151\x6d\147\133\x5c\163\x2f\135\53\x2e\x2a\77\x73\162\x63\x5c\x73\52\x3d\x5c\163\x2a\77\x28\x28\x5b\x5e\134\163\42\47\75\74\76\x60\x5d\x2b\x29\51\56\x2a\x3f\x5c\x3e\43\151"), "\x5c\x32", $str); } protected function _urldecodespaces($matches) { goto dTlJ9; rpxJ6: $nospaces = preg_replace("\43\134\163\53\43", '', $input); goto Iv87B; dTlJ9: $input = $matches[0]; goto rpxJ6; Iv87B: return $nospaces === $input ? $input : rawurldecode($nospaces); goto K0bru; K0bru: } protected function _compact_exploded_words($matches) { return preg_replace("\x2f\x5c\163\53\x2f\163", '', $matches[1]) . $matches[2]; } protected function _sanitize_naughty_html($matches) { goto bjkLF; g2n5v: static $evil_attributes = array("\157\156\134\x77\53", "\x73\x74\171\x6c\x65", "\170\155\x6c\156\163", "\146\x6f\162\155\141\x63\164\x69\157\156", "\x66\x6f\162\155", "\x78\154\151\x6e\153\x3a\150\162\145\146", "\x46\x53\x43\x6f\x6d\155\141\156\x64", "\163\x65\145\153\x53\145\x67\155\145\156\x74\x54\151\x6d\x65"); goto psGSq; ySY0s: return $matches[0]; goto IbCYy; psGSq: if (empty($matches["\143\154\157\x73\145\x54\x61\147"])) { return "\46\x6c\x74\73" . $matches[1]; } elseif (in_array(strtolower($matches["\164\x61\147\x4e\141\155\145"]), $naughty_tags, TRUE)) { return "\x26\154\x74\73" . $matches[1] . "\46\147\x74\73"; } elseif (isset($matches["\141\x74\164\162\x69\x62\165\164\145\x73"])) { goto ngVyH; Zd0ml: $attributes = empty($attributes) ? '' : "\x20" . implode("\40", $attributes); goto g9aiK; c2SOf: $attributes_pattern = "\43" . "\x28\77\x3c\x6e\141\155\145\76\x5b\x5e\134\x73\x5c\60\64\x32\x5c\x30\x34\x37\76\x2f\x3d\x5d\x2b\51" . "\50\77\x3a\x5c\x73\x2a\x3d\x28\77\x3c\166\x61\154\165\145\x3e\x5b\x5e\134\163\134\x30\64\x32\134\60\x34\67\75\x3e\74\x60\x5d\x2b\x7c\134\163\x2a\134\x30\x34\x32\x5b\x5e\x5c\x30\x34\62\x5d\52\x5c\60\64\x32\174\134\x73\52\x5c\x30\64\67\x5b\x5e\134\x30\x34\x37\x5d\52\x5c\60\x34\67\x7c\134\x73\x2a\50\77\x55\72\133\136\x5c\163\x5c\x30\x34\62\134\60\64\x37\x3d\x3e\x3c\x60\x5d\x2a\51\x29\51" . "\43\151"; goto Y2xgZ; g9aiK: return "\x3c" . $matches["\163\x6c\141\163\x68"] . $matches["\164\141\x67\116\x61\x6d\145"] . $attributes . "\x3e"; goto R4N_v; Y2xgZ: $is_evil_pattern = "\x23\136\50" . implode("\x7c", $evil_attributes) . "\x29\44\x23\x69"; goto zVvEr; ngVyH: $attributes = array(); goto c2SOf; zVvEr: do { $matches["\141\x74\164\162\151\142\x75\164\145\163"] = preg_replace("\43\x5e\133\x5e\x61\55\172\135\x2b\43\151", '', $matches["\x61\x74\164\x72\151\142\x75\164\145\163"]); if (!preg_match($attributes_pattern, $matches["\141\x74\x74\x72\151\142\x75\x74\x65\x73"], $attribute, PREG_OFFSET_CAPTURE)) { break; } if (preg_match($is_evil_pattern, $attribute["\156\141\x6d\x65"][0]) or trim($attribute["\166\141\x6c\x75\x65"][0]) === '') { $attributes[] = "\170\x73\x73\75\x72\145\x6d\x6f\166\145\x64"; } else { $attributes[] = $attribute[0][0]; } $matches["\141\x74\164\162\151\142\x75\164\x65\x73"] = substr($matches["\141\x74\164\162\151\142\x75\164\145\163"], $attribute[0][1] + strlen($attribute[0][0])); } while ($matches["\141\164\164\x72\x69\142\x75\164\145\x73"] !== ''); goto Zd0ml; R4N_v: } goto ySY0s; bjkLF: static $naughty_tags = array("\x61\154\145\162\x74", "\141\x72\x65\x61", "\x70\162\x6f\x6d\x70\164", "\x63\x6f\x6e\146\151\162\155", "\x61\160\160\x6c\145\x74", "\141\x75\144\x69\157", "\x62\x61\163\x65\146\x6f\156\x74", "\x62\141\x73\145", "\142\x65\150\141\166\x69\x6f\x72", "\x62\x67\x73\x6f\165\x6e\x64", "\x62\154\151\x6e\x6b", "\x62\x6f\x64\171", "\145\x6d\142\145\x64", "\x65\170\x70\162\145\x73\163\x69\x6f\156", "\x66\x6f\x72\x6d", "\x66\x72\141\155\x65\x73\x65\x74", "\x66\x72\x61\x6d\x65", "\x68\145\141\x64", "\x68\164\155\x6c", "\x69\x6c\141\x79\x65\x72", "\x69\x66\162\141\155\x65", "\151\156\160\165\164", "\142\165\164\164\x6f\x6e", "\x73\145\x6c\x65\143\164", "\151\x73\x69\156\144\145\x78", "\154\141\171\145\162", "\154\151\x6e\x6b", "\155\145\x74\x61", "\153\145\x79\147\x65\x6e", "\157\142\x6a\x65\x63\x74", "\x70\x6c\141\x69\156\x74\145\170\164", "\163\164\171\x6c\x65", "\x73\143\x72\x69\160\164", "\x74\145\x78\164\141\162\145\x61", "\164\151\164\154\145", "\x6d\x61\x74\150", "\166\151\144\x65\157", "\163\x76\147", "\x78\x6d\154", "\170\x73\163"); goto g2n5v; IbCYy: } protected function _js_link_removal($match) { return str_replace($match[1], preg_replace("\x23\150\162\145\146\75\56\52\x3f\x28\x3f\72\50\77\x3a\x61\x6c\x65\x72\x74\x7c\x70\162\157\x6d\160\x74\174\x63\157\x6e\x66\x69\x72\155\x29\50\77\72\x5c\50\174\x26\134\43\64\60\x3b\174\140\x7c\x26\x5c\43\71\x36\73\51\174\152\141\x76\141\x73\x63\162\x69\160\164\x3a\x7c\154\151\166\145\163\143\162\x69\x70\164\x3a\174\x6d\x6f\x63\150\141\x3a\174\x63\150\141\162\163\145\164\75\174\x77\x69\x6e\144\x6f\x77\x5c\56\x7c\134\50\x3f\144\x6f\x63\x75\x6d\145\156\x74\x5c\x29\77\134\56\x7c\134\56\143\x6f\157\x6b\151\145\174\74\x73\143\x72\151\160\164\x7c\74\x78\x73\x73\x7c\144\134\x73\52\x61\x5c\163\x2a\164\134\x73\52\x61\134\x73\52\72\x29\43\x73\x69", '', $this->_filter_attributes($match[1])), $match[0]); } protected function _js_img_removal($match) { return str_replace($match[1], preg_replace("\43\x73\162\143\x3d\56\x2a\77\x28\77\x3a\x28\x3f\x3a\x61\154\145\162\x74\x7c\x70\x72\x6f\155\x70\164\174\x63\157\x6e\x66\x69\162\x6d\x7c\145\166\141\154\51\x28\x3f\72\x5c\x28\x7c\46\134\x23\64\60\x3b\x7c\x60\x7c\46\x5c\x23\71\x36\x3b\x29\174\152\x61\166\141\x73\x63\162\151\160\x74\x3a\x7c\154\x69\x76\145\x73\x63\162\x69\160\x74\x3a\174\x6d\157\143\150\x61\x3a\174\x63\x68\141\x72\163\145\x74\x3d\x7c\x77\x69\156\x64\157\x77\134\x2e\174\x5c\50\x3f\144\157\143\165\x6d\x65\x6e\164\x5c\51\77\134\56\x7c\134\56\x63\157\157\x6b\x69\x65\174\x3c\163\x63\x72\151\x70\x74\174\x3c\170\163\x73\x7c\x62\141\x73\145\66\64\134\163\x2a\x2c\51\x23\163\151", '', $this->_filter_attributes($match[1])), $match[0]); } protected function _convert_attribute($match) { return str_replace(array("\x3e", "\74", "\134"), array("\x26\147\x74\73", "\x26\154\164\x3b", "\134\134"), $match[0]); } protected function _filter_attributes($str) { goto pyPcf; EaBr0: return $out; goto QboZv; TWJon: if (preg_match_all("\43\134\x73\52\x5b\x61\55\x7a\x5c\55\135\53\134\x73\x2a\x3d\x5c\163\x2a\x28\134\x30\x34\62\174\134\x30\x34\67\x29\50\133\x5e\x5c\x31\135\52\77\51\x5c\61\43\151\163", $str, $matches)) { foreach ($matches[0] as $match) { $out .= preg_replace("\x23\57\x5c\52\x2e\x2a\x3f\134\52\x2f\43\163", '', $match); } } goto EaBr0; pyPcf: $out = ''; goto TWJon; QboZv: } protected function _decode_entity($match) { $match = preg_replace("\x7c\134\x26\x28\x5b\141\55\172\x5c\137\60\55\71\x5c\55\135\x2b\x29\134\75\x28\133\x61\55\x7a\x5c\x5f\x30\55\71\x5c\x2d\x2f\x5d\x2b\x29\x7c\x69", $this->xss_hash() . "\x5c\x31\x3d\x5c\x32", $match[0]); return str_replace($this->xss_hash(), "\x26", $this->entity_decode($match, $this->charset)); } protected function _do_never_allowed($str) { goto cz85_; W0MSj: return $str; goto xTZY9; DfCOx: foreach ($this->_never_allowed_regex as $regex) { $str = preg_replace("\43" . $regex . "\43\x69\163", "\x5b\162\145\x6d\157\x76\x65\144\x5d", $str); } goto W0MSj; cz85_: $str = str_replace(array_keys($this->_never_allowed_str), $this->_never_allowed_str, $str); goto DfCOx; xTZY9: } protected function _csrf_set_hash() { if ($this->_csrf_hash === NULL) { goto zzCCc; P2hI2: $rand = $this->get_random_bytes(16); goto jBiVN; jBiVN: $this->_csrf_hash = $rand === FALSE ? md5(uniqid(mt_rand(), TRUE)) : bin2hex($rand); goto vVZ7S; zzCCc: if (isset($_COOKIE[$this->_csrf_cookie_name]) && is_string($_COOKIE[$this->_csrf_cookie_name]) && preg_match("\43\136\x5b\x30\x2d\x39\141\x2d\146\135\173\63\62\175\44\43\151\x53", $_COOKIE[$this->_csrf_cookie_name]) === 1) { return $this->_csrf_hash = $_COOKIE[$this->_csrf_cookie_name]; } goto P2hI2; vVZ7S: } return $this->_csrf_hash; } }
