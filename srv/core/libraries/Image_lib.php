<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.14  |
    |              on 2024-09-11 13:11:16              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*

*/
 defined("\x42\101\x53\x45\120\x41\124\x48") or exit("\x4e\157\40\144\151\x72\145\x63\x74\40\163\x63\162\x69\160\164\40\x61\x63\x63\x65\x73\163\40\141\154\x6c\x6f\x77\x65\144"); class CI_Image_lib { public $image_library = "\x67\144\x32"; public $library_path = ''; public $dynamic_output = FALSE; public $source_image = ''; public $new_image = ''; public $width = ''; public $height = ''; public $quality = 90; public $create_thumb = FALSE; public $thumb_marker = "\137\164\150\x75\x6d\142"; public $maintain_ratio = TRUE; public $master_dim = "\141\165\x74\x6f"; public $rotation_angle = ''; public $x_axis = ''; public $y_axis = ''; public $wm_text = ''; public $wm_type = "\164\x65\170\x74"; public $wm_x_transp = 4; public $wm_y_transp = 4; public $wm_overlay_path = ''; public $wm_font_path = ''; public $wm_font_size = 17; public $wm_vrt_alignment = "\x42"; public $wm_hor_alignment = "\x43"; public $wm_padding = 0; public $wm_hor_offset = 0; public $wm_vrt_offset = 0; protected $wm_font_color = "\43\146\x66\146\146\x66\146"; protected $wm_shadow_color = ''; public $wm_shadow_distance = 2; public $wm_opacity = 50; public $source_folder = ''; public $dest_folder = ''; public $mime_type = ''; public $orig_width = ''; public $orig_height = ''; public $image_type = ''; public $size_str = ''; public $full_src_path = ''; public $full_dst_path = ''; public $file_permissions = 0644; public $create_fnc = "\151\x6d\x61\147\145\143\162\x65\x61\x74\x65\164\x72\x75\145\143\157\154\157\162"; public $copy_fnc = "\x69\x6d\x61\147\145\143\x6f\x70\x79\x72\x65\x73\x61\x6d\x70\154\x65\144"; public $error_msg = array(); protected $wm_use_drop_shadow = FALSE; public $wm_use_truetype = FALSE; public function __construct($props = array()) { goto rcesM; U7QZ8: log_message("\151\156\146\x6f", "\111\x6d\x61\x67\x65\40\114\151\142\40\x43\x6c\141\163\163\x20\x49\x6e\x69\x74\151\141\154\x69\172\145\x64"); goto c7zQC; rcesM: if (count($props) > 0) { $this->initialize($props); } goto jm97r; jm97r: ini_set("\x67\x64\56\x6a\x70\x65\x67\137\151\147\x6e\157\162\x65\137\167\x61\162\156\x69\156\147", 1); goto U7QZ8; c7zQC: } public function clear() { goto cJU23; nrwof: $this->wm_opacity = 50; goto PN02e; UbJsO: $this->wm_padding = 0; goto cIxNQ; yC8M7: $this->wm_hor_alignment = "\x43"; goto UbJsO; W34Kk: foreach ($props as $val) { $this->{$val} = ''; } goto HJ4Vx; tIMJU: $this->wm_vrt_alignment = "\102"; goto yC8M7; M2BRM: $this->master_dim = "\141\165\x74\157"; goto wbNYw; ZJ6_M: $this->wm_font_color = "\43\x66\x66\146\x66\146\x66"; goto uMYLZ; cO414: $this->wm_x_transp = 4; goto Uro3D; MN904: $this->wm_vrt_offset = 0; goto ZJ6_M; T0cTy: $this->quality = 90; goto QS2kc; Hr84c: $this->maintain_ratio = TRUE; goto M2BRM; PN02e: $this->create_fnc = "\151\x6d\x61\147\x65\x63\162\145\141\164\145\x74\162\x75\x65\143\157\154\x6f\162"; goto B16P1; B16P1: $this->copy_fnc = "\151\155\x61\x67\x65\143\x6f\160\x79\x72\x65\163\141\x6d\160\154\145\x64"; goto p685e; T55Pj: $this->thumb_marker = "\x5f\164\150\165\155\x62"; goto Hr84c; QS2kc: $this->create_thumb = FALSE; goto T55Pj; wbNYw: $this->wm_type = "\164\145\170\x74"; goto cO414; YuCCP: $this->wm_font_size = 17; goto tIMJU; HJ4Vx: $this->image_library = "\147\x64\62"; goto xwxVo; p685e: $this->error_msg = array(); goto wQ97R; uMYLZ: $this->wm_shadow_distance = 2; goto nrwof; cIxNQ: $this->wm_hor_offset = 0; goto MN904; xwxVo: $this->dynamic_output = FALSE; goto T0cTy; cJU23: $props = array("\x74\x68\x75\155\x62\x5f\155\141\162\153\x65\x72", "\154\151\142\162\141\162\171\x5f\x70\x61\164\150", "\x73\x6f\x75\x72\x63\145\137\151\x6d\x61\147\x65", "\156\145\x77\x5f\151\155\x61\x67\x65", "\x77\151\x64\164\x68", "\150\145\151\x67\150\164", "\x72\157\164\x61\164\151\x6f\156\137\x61\x6e\x67\154\145", "\170\x5f\x61\x78\x69\163", "\x79\x5f\x61\x78\151\163", "\167\x6d\137\164\145\170\164", "\x77\155\x5f\x6f\166\x65\162\x6c\x61\x79\137\x70\141\164\x68", "\167\155\137\146\x6f\156\164\x5f\160\x61\164\x68", "\167\x6d\x5f\x73\150\141\x64\x6f\167\137\143\157\154\x6f\x72", "\163\157\165\x72\143\x65\137\x66\157\x6c\144\x65\162", "\x64\145\163\164\137\146\x6f\x6c\x64\145\x72", "\155\x69\155\x65\137\x74\171\x70\x65", "\x6f\162\x69\147\137\x77\151\x64\164\150", "\157\x72\x69\147\x5f\150\145\151\147\x68\164", "\x69\x6d\141\147\145\x5f\164\x79\160\145", "\x73\151\x7a\x65\137\163\164\162", "\146\x75\x6c\x6c\137\163\x72\x63\137\x70\141\164\x68", "\146\165\154\x6c\x5f\x64\163\x74\x5f\160\x61\164\x68"); goto W34Kk; wQ97R: $this->wm_use_drop_shadow = FALSE; goto vl70i; vl70i: $this->wm_use_truetype = FALSE; goto g4TvY; Uro3D: $this->wm_y_transp = 4; goto YuCCP; g4TvY: } public function initialize($props = array()) { goto bi_IA; yezbm: if (!$this->get_image_properties($this->source_folder . $this->source_image)) { return FALSE; } goto yJiYS; W6Kma: $this->quality = trim(str_replace("\45", '', $this->quality)); goto bI1z9; Ej9Nz: if ($this->source_image === '') { $this->set_error("\151\x6d\147\x6c\151\x62\x5f\x73\157\165\162\x63\145\x5f\151\155\x61\147\x65\x5f\x72\x65\x71\165\x69\162\145\144"); return FALSE; } goto hkeJ5; UIfoJ: if ($this->maintain_ratio === TRUE && ($this->width !== 0 or $this->height !== 0)) { $this->image_reproportion(); } goto LMlMm; ua37k: if ($this->wm_shadow_color !== '') { $this->wm_use_drop_shadow = TRUE; } elseif ($this->wm_use_drop_shadow === TRUE && $this->wm_shadow_color === '') { $this->wm_use_drop_shadow = FALSE; } goto ZHr75; vMfJb: $xp = $this->explode_name($this->dest_image); goto Yzb7o; e3gDW: is_numeric($this->y_axis) or $this->y_axis = 0; goto xDEJL; ZHr75: if ($this->wm_font_path !== '') { $this->wm_use_truetype = TRUE; } goto o0eSB; VXYl1: $this->source_folder = str_replace($this->source_image, '', $full_source_path); goto yezbm; Qn2rD: $this->image_library = strtolower($this->image_library); goto OGYuT; o0eSB: return TRUE; goto PacDQ; Yzb7o: $filename = $xp["\156\x61\155\x65"]; goto Ci6yP; hkeJ5: if (!function_exists("\147\x65\164\x69\x6d\141\x67\145\163\x69\172\x65")) { $this->set_error("\151\x6d\x67\x6c\x69\142\x5f\x67\144\137\x72\145\161\x75\151\162\145\144\137\146\x6f\162\137\x70\x72\x6f\x70\163"); return FALSE; } goto Qn2rD; bi_IA: if (count($props) > 0) { foreach ($props as $key => $val) { if (property_exists($this, $key)) { if (in_array($key, array("\167\x6d\137\146\157\x6e\x74\137\x63\x6f\x6c\x6f\x72", "\167\155\137\x73\x68\141\144\157\167\137\143\x6f\154\x6f\x72"), TRUE)) { if (preg_match("\x2f\x5e\x23\77\x28\x5b\60\x2d\x39\141\55\146\x5d\173\63\175\174\133\60\x2d\71\141\55\146\x5d\x7b\x36\175\51\x24\57\x69", $val, $matches)) { $val = strlen($matches[1]) === 6 ? "\43" . $matches[1] : "\43" . $matches[1][0] . $matches[1][0] . $matches[1][1] . $matches[1][1] . $matches[1][2] . $matches[1][2]; } else { continue; } } elseif (in_array($key, array("\x77\x69\x64\164\150", "\150\x65\151\x67\150\x74"), TRUE) && !ctype_digit((string) $val)) { continue; } $this->{$key} = $val; } } } goto Ej9Nz; hX17x: $x = explode("\57", $full_source_path); goto YgoIy; bI1z9: if ($this->quality === '' or $this->quality === 0 or !ctype_digit($this->quality)) { $this->quality = 90; } goto OK3DG; re5uA: $this->full_dst_path = $this->dest_folder . $filename . $this->thumb_marker . $file_ext; goto UIfoJ; LMlMm: if ($this->width === '') { $this->width = $this->orig_width; } goto sCVIl; pYE7g: if ($this->create_thumb === FALSE or $this->thumb_marker === '') { $this->thumb_marker = ''; } goto vMfJb; sCVIl: if ($this->height === '') { $this->height = $this->orig_height; } goto W6Kma; OGYuT: if (($full_source_path = realpath($this->source_image)) !== FALSE) { $full_source_path = str_replace("\x5c", "\x2f", $full_source_path); } else { $full_source_path = $this->source_image; } goto hX17x; Ci6yP: $file_ext = $xp["\x65\170\x74"]; goto Bznhj; YgoIy: $this->source_image = end($x); goto VXYl1; Bznhj: $this->full_src_path = $this->source_folder . $this->source_image; goto re5uA; xDEJL: if ($this->wm_overlay_path !== '') { $this->wm_overlay_path = str_replace("\134", "\57", realpath($this->wm_overlay_path)); } goto ua37k; yJiYS: if ($this->new_image === '') { $this->dest_image = $this->source_image; $this->dest_folder = $this->source_folder; } elseif (strpos($this->new_image, "\57") === FALSE && strpos($this->new_image, "\134") === FALSE) { $this->dest_image = $this->new_image; $this->dest_folder = $this->source_folder; } else { if (!preg_match("\43\134\56\x28\152\x70\x67\x7c\x6a\160\145\147\174\147\151\x66\174\x70\156\x67\x29\x24\43\151", $this->new_image)) { $this->dest_image = $this->source_image; $this->dest_folder = $this->new_image; } else { goto sQV2q; cIGxZ: $this->dest_image = end($x); goto Jh4AP; sQV2q: $x = explode("\x2f", str_replace("\x5c", "\57", $this->new_image)); goto cIGxZ; Jh4AP: $this->dest_folder = str_replace($this->dest_image, '', $this->new_image); goto RddL_; RddL_: } $this->dest_folder = realpath($this->dest_folder) . "\57"; } goto pYE7g; OK3DG: is_numeric($this->x_axis) or $this->x_axis = 0; goto e3gDW; PacDQ: } public function resize() { $protocol = $this->image_library === "\x67\144\x32" ? "\151\155\x61\147\145\137\x70\x72\157\x63\145\163\x73\137\x67\x64" : "\151\155\x61\x67\145\x5f\x70\162\157\143\x65\x73\163\137" . $this->image_library; return $this->{$protocol}("\x72\x65\x73\x69\172\145"); } public function crop() { $protocol = $this->image_library === "\x67\x64\62" ? "\x69\155\141\147\x65\137\x70\162\157\x63\145\x73\x73\x5f\147\x64" : "\x69\155\141\x67\x65\137\160\x72\x6f\x63\x65\163\x73\137" . $this->image_library; return $this->{$protocol}("\143\x72\x6f\160"); } public function rotate() { goto KPhTA; mi6sx: return ($this->rotation_angle === "\x68\x6f\x72" or $this->rotation_angle === "\166\x72\x74") ? $this->image_mirror_gd() : $this->image_rotate_gd(); goto iB52M; ABQxt: if ($this->rotation_angle === '' or !in_array($this->rotation_angle, $degs)) { $this->set_error("\151\155\x67\154\x69\142\x5f\162\x6f\164\x61\x74\x69\157\x6e\x5f\x61\x6e\147\x6c\x65\137\162\x65\x71\x75\151\162\145\x64"); return FALSE; } goto hfFTn; Kn2if: if ($this->image_library === "\x69\x6d\141\147\x65\x6d\x61\147\x69\143\x6b" or $this->image_library === "\x6e\x65\x74\160\142\x6d") { $protocol = "\x69\x6d\x61\x67\145\x5f\x70\x72\x6f\143\x65\x73\x73\137" . $this->image_library; return $this->{$protocol}("\162\x6f\164\141\x74\x65"); } goto mi6sx; KPhTA: $degs = array(90, 180, 270, "\166\162\x74", "\x68\x6f\162"); goto ABQxt; hfFTn: if ($this->rotation_angle === 90 or $this->rotation_angle === 270) { $this->width = $this->orig_height; $this->height = $this->orig_width; } else { $this->width = $this->orig_width; $this->height = $this->orig_height; } goto Kn2if; iB52M: } public function image_process_gd($action = "\x72\145\163\x69\172\x65") { goto No2O2; JZF6L: if ($this->image_type === 3) { imagealphablending($dst_img, FALSE); imagesavealpha($dst_img, TRUE); } goto q4Iil; Q7SSX: if ($this->dynamic_output === TRUE) { $this->image_display_gd($dst_img); } elseif (!$this->image_save_gd($dst_img)) { return FALSE; } goto R9ARr; R9ARr: imagedestroy($dst_img); goto W1g9V; q4Iil: $copy($dst_img, $src_img, 0, 0, $this->x_axis, $this->y_axis, $this->width, $this->height, $this->orig_width, $this->orig_height); goto Q7SSX; No2O2: $v2_override = FALSE; goto aI6Nl; fsejK: $dst_img = $create($this->width, $this->height); goto JZF6L; W1g9V: imagedestroy($src_img); goto iOuVS; iOuVS: if ($this->dynamic_output !== TRUE) { chmod($this->full_dst_path, $this->file_permissions); } goto IieVt; mRJAU: if ($this->image_library === "\x67\x64\62" && function_exists("\x69\x6d\x61\147\x65\143\162\x65\141\164\145\x74\x72\165\145\143\157\154\157\162")) { $create = "\x69\155\x61\147\145\143\162\145\141\164\x65\x74\x72\165\x65\143\x6f\154\x6f\162"; $copy = "\151\x6d\141\x67\x65\x63\157\x70\x79\162\x65\x73\x61\x6d\x70\x6c\x65\x64"; } else { $create = "\151\155\141\x67\x65\x63\x72\145\x61\x74\x65"; $copy = "\x69\x6d\141\x67\145\143\x6f\x70\x79\162\145\163\x69\x7a\x65\x64"; } goto fsejK; jNgnA: if (!($src_img = $this->image_create_gd())) { return FALSE; } goto mRJAU; R1rGe: if ($action === "\x63\x72\157\x70") { goto h7HOM; h7HOM: $this->orig_width = $this->width; goto fP4C5; fP4C5: $this->orig_height = $this->height; goto yNA6k; yNA6k: if ($this->gd_version() !== FALSE) { $gd_version = str_replace("\x30", '', $this->gd_version()); $v2_override = $gd_version == 2; } goto pSmc0; pSmc0: } else { $this->x_axis = 0; $this->y_axis = 0; } goto jNgnA; IieVt: return TRUE; goto SJAHX; aI6Nl: if ($this->dynamic_output === FALSE && $this->orig_width === $this->width && $this->orig_height === $this->height) { if ($this->source_image !== $this->new_image && @copy($this->full_src_path, $this->full_dst_path)) { chmod($this->full_dst_path, $this->file_permissions); } return TRUE; } goto R1rGe; SJAHX: } public function image_process_imagemagick($action = "\x72\x65\163\x69\x7a\145") { goto Woo23; Woo23: if ($this->library_path === '') { $this->set_error("\151\x6d\147\x6c\x69\x62\x5f\154\151\142\160\141\164\150\x5f\x69\156\166\x61\154\151\x64"); return FALSE; } goto V0yJt; oYmvE: $retval = 1; goto XYudf; ftw7u: if ($retval > 0) { $this->set_error("\151\155\x67\x6c\151\x62\137\x69\x6d\x61\x67\x65\x5f\160\162\x6f\143\145\x73\x73\137\146\x61\x69\x6c\x65\x64"); return FALSE; } goto OeSJu; OeSJu: chmod($this->full_dst_path, $this->file_permissions); goto ZTDev; JzzNH: $cmd .= "\40" . escapeshellarg($this->full_src_path) . "\x20" . escapeshellarg($this->full_dst_path) . "\x20\x32\76\x26\x31"; goto oYmvE; w5R9i: $cmd = $this->library_path . "\40\55\161\x75\141\x6c\x69\x74\171\x20" . $this->quality; goto ea3we; ZTDev: return TRUE; goto nS3am; XYudf: if (function_usable("\145\x78\145\143")) { @exec($cmd, $output, $retval); } goto ftw7u; ea3we: if ($action === "\143\162\x6f\x70") { $cmd .= "\40\55\x63\x72\157\x70\40" . $this->width . "\x78" . $this->height . "\53" . $this->x_axis . "\x2b" . $this->y_axis; } elseif ($action === "\162\157\x74\141\164\x65") { $cmd .= ($this->rotation_angle === "\150\x6f\162" or $this->rotation_angle === "\166\162\164") ? "\40\55\x66\x6c\x6f\160" : "\x20\55\162\x6f\164\141\164\145\40" . $this->rotation_angle; } else { if ($this->maintain_ratio === TRUE) { $cmd .= "\40\55\x72\x65\163\x69\x7a\145\x20" . $this->width . "\x78" . $this->height; } else { $cmd .= "\40\55\x72\x65\163\x69\x7a\145\x20" . $this->width . "\170" . $this->height . "\134\41"; } } goto JzzNH; V0yJt: if (!preg_match("\x2f\x63\x6f\156\166\x65\x72\x74\44\x2f\151", $this->library_path)) { $this->library_path = rtrim($this->library_path, "\57") . "\x2f\143\157\x6e\x76\145\162\x74"; } goto w5R9i; nS3am: } public function image_process_netpbm($action = "\x72\145\x73\x69\x7a\145") { goto XMrjt; PAYWG: if ($retval > 0) { $this->set_error("\151\x6d\x67\154\x69\x62\137\x69\x6d\141\x67\145\x5f\160\x72\x6f\143\x65\163\x73\x5f\146\141\151\x6c\145\144"); return FALSE; } goto zyFs7; KBkVu: switch ($this->image_type) { case 1: goto Wls5u; HO7VL: $cmd_out = "\160\x70\x6d\x74\x6f\147\151\x66"; goto MT0G3; MT0G3: break; goto hVcmy; Wls5u: $cmd_in = "\x67\151\146\x74\x6f\160\156\x6d"; goto HO7VL; hVcmy: case 2: goto Bd2CT; iahBB: break; goto JnW3M; Bd2CT: $cmd_in = "\x6a\160\x65\x67\164\157\160\x6e\155"; goto OFGKV; OFGKV: $cmd_out = "\160\x70\x6d\x74\x6f\152\160\x65\147"; goto iahBB; JnW3M: case 3: goto ajfnQ; GpYoM: break; goto Ouv1C; jJ3nm: $cmd_out = "\x70\160\x6d\x74\x6f\160\156\x67"; goto GpYoM; ajfnQ: $cmd_in = "\x70\156\147\164\x6f\x70\156\x6d"; goto jJ3nm; Ouv1C: } goto if07f; lCbzG: return TRUE; goto gMoNd; sUZ5Y: $cmd = $this->library_path . $cmd_in . "\40" . escapeshellarg($this->full_src_path) . "\x20\x7c\40" . $cmd_inner . "\x20\174\x20" . $cmd_out . "\40\76\x20" . $this->dest_folder . "\x6e\145\x74\160\142\155\56\164\x6d\x70"; goto lj4hm; XMrjt: if ($this->library_path === '') { $this->set_error("\x69\155\147\154\151\142\137\154\x69\x62\x70\x61\x74\x68\137\151\x6e\x76\141\x6c\151\144"); return FALSE; } goto KBkVu; if07f: if ($action === "\143\162\x6f\x70") { $cmd_inner = "\160\156\155\143\165\x74\40\55\x6c\x65\x66\x74\x20" . $this->x_axis . "\x20\55\x74\157\160\40" . $this->y_axis . "\40\55\x77\x69\x64\x74\150\x20" . $this->width . "\40\x2d\x68\145\151\147\150\164\40" . $this->height; } elseif ($action === "\x72\x6f\x74\141\164\145") { switch ($this->rotation_angle) { case 90: $angle = "\162\62\67\60"; break; case 180: $angle = "\162\61\x38\x30"; break; case 270: $angle = "\162\71\x30"; break; case "\x76\162\164": $angle = "\x74\142"; break; case "\x68\157\x72": $angle = "\154\162"; break; } $cmd_inner = "\x70\156\x6d\x66\154\151\x70\x20\55" . $angle . "\40"; } else { $cmd_inner = "\x70\156\155\163\143\x61\154\145\40\55\170\171\x73\151\172\x65\40" . $this->width . "\x20" . $this->height; } goto sUZ5Y; zyFs7: copy($this->dest_folder . "\x6e\145\x74\x70\x62\155\56\164\x6d\x70", $this->full_dst_path); goto wSelV; LMFdc: chmod($this->full_dst_path, $this->file_permissions); goto lCbzG; lj4hm: $retval = 1; goto qkow3; qkow3: if (function_usable("\145\x78\145\143")) { @exec($cmd, $output, $retval); } goto PAYWG; wSelV: unlink($this->dest_folder . "\156\145\164\160\142\x6d\x2e\164\155\160"); goto LMFdc; gMoNd: } public function image_rotate_gd() { goto sJOke; sJOke: if (!($src_img = $this->image_create_gd())) { return FALSE; } goto QW0B3; PDYCg: $dst_img = imagerotate($src_img, $this->rotation_angle, $white); goto Lr484; mCF14: chmod($this->full_dst_path, $this->file_permissions); goto DIg5Z; tDk1Z: imagedestroy($dst_img); goto FGP63; FGP63: imagedestroy($src_img); goto mCF14; DIg5Z: return TRUE; goto kVRrB; Lr484: if ($this->dynamic_output === TRUE) { $this->image_display_gd($dst_img); } elseif (!$this->image_save_gd($dst_img)) { return FALSE; } goto tDk1Z; QW0B3: $white = imagecolorallocate($src_img, 255, 255, 255); goto PDYCg; kVRrB: } public function image_mirror_gd() { goto hZNXd; pAKRV: return TRUE; goto lIxEp; e7MgB: chmod($this->full_dst_path, $this->file_permissions); goto pAKRV; a4OVX: if ($this->dynamic_output === TRUE) { $this->image_display_gd($src_img); } elseif (!$this->image_save_gd($src_img)) { return FALSE; } goto ITDRu; ITDRu: imagedestroy($src_img); goto e7MgB; Vevtz: if ($this->rotation_angle === "\x68\157\x72") { for ($i = 0; $i < $height; $i++) { $left = 0; $right = $width - 1; while ($left < $right) { $cl = imagecolorat($src_img, $left, $i); $cr = imagecolorat($src_img, $right, $i); imagesetpixel($src_img, $left, $i, $cr); imagesetpixel($src_img, $right, $i, $cl); $left++; $right--; } } } else { for ($i = 0; $i < $width; $i++) { $top = 0; $bottom = $height - 1; while ($top < $bottom) { $ct = imagecolorat($src_img, $i, $top); $cb = imagecolorat($src_img, $i, $bottom); imagesetpixel($src_img, $i, $top, $cb); imagesetpixel($src_img, $i, $bottom, $ct); $top++; $bottom--; } } } goto a4OVX; n8_aR: $width = $this->orig_width; goto ojLmh; ojLmh: $height = $this->orig_height; goto Vevtz; hZNXd: if (!($src_img = $this->image_create_gd())) { return FALSE; } goto n8_aR; lIxEp: } public function watermark() { return $this->wm_type === "\157\166\145\162\154\x61\x79" ? $this->overlay_watermark() : $this->text_watermark(); } public function overlay_watermark() { goto JlZW3; qMDeF: $wm_img_type = $props["\151\x6d\141\147\145\137\164\171\x70\x65"]; goto cfO5b; se03b: $wm_img = $this->image_create_gd($this->wm_overlay_path, $wm_img_type); goto ADtjW; KCwqs: $y_axis = $this->wm_vrt_offset + $this->wm_padding; goto odZdX; C03Hs: $rgba = imagecolorat($wm_img, $this->wm_x_transp, $this->wm_y_transp); goto IFJ66; wdN0k: $wm_height = $props["\150\145\151\147\x68\x74"]; goto se03b; m3FjL: $this->wm_vrt_alignment = strtoupper($this->wm_vrt_alignment[0]); goto baQg0; HwB7y: if ($this->image_type === 3) { imagealphablending($src_img, FALSE); imagesavealpha($src_img, TRUE); } goto FFxy7; IFJ66: $alpha = ($rgba & 0x7f000000) >> 24; goto SKcGN; wxw4J: $props = $this->get_image_properties($this->wm_overlay_path, TRUE); goto qMDeF; cfO5b: $wm_width = $props["\167\x69\x64\164\x68"]; goto wdN0k; GYqk5: if ($this->wm_vrt_alignment === "\102") { $this->wm_vrt_offset = $this->wm_vrt_offset * -1; } goto nPViW; baQg0: $this->wm_hor_alignment = strtoupper($this->wm_hor_alignment[0]); goto GYqk5; FM01L: $x_axis = $this->wm_hor_offset + $this->wm_padding; goto KCwqs; N6znW: if ($this->wm_hor_alignment === "\103") { $x_axis += $this->orig_width / 2 - $wm_width / 2; } elseif ($this->wm_hor_alignment === "\122") { $x_axis += $this->orig_width - $wm_width; } goto mAvZs; MKF1h: imagedestroy($wm_img); goto kKC5O; mAvZs: if ($wm_img_type === 3 && function_exists("\151\x6d\x61\x67\x65\141\x6c\160\x68\141\x62\x6c\x65\x6e\144\151\x6e\147")) { @imagealphablending($src_img, TRUE); } goto C03Hs; FFxy7: if ($this->dynamic_output === TRUE) { $this->image_display_gd($src_img); } elseif (!$this->image_save_gd($src_img)) { return FALSE; } goto lxxYV; ADtjW: $src_img = $this->image_create_gd($this->full_src_path); goto m3FjL; JlZW3: if (!function_exists("\x69\x6d\141\147\145\143\x6f\x6c\157\x72\x74\x72\x61\x6e\x73\x70\141\x72\x65\x6e\x74")) { $this->set_error("\x69\155\147\x6c\151\142\137\147\x64\137\x72\x65\161\165\151\x72\x65\x64"); return FALSE; } goto Cqz89; Cqz89: $this->get_image_properties(); goto wxw4J; SKcGN: if ($alpha > 0) { imagecopy($src_img, $wm_img, $x_axis, $y_axis, 0, 0, $wm_width, $wm_height); } else { imagecolortransparent($wm_img, imagecolorat($wm_img, $this->wm_x_transp, $this->wm_y_transp)); imagecopymerge($src_img, $wm_img, $x_axis, $y_axis, 0, 0, $wm_width, $wm_height, $this->wm_opacity); } goto HwB7y; kKC5O: return TRUE; goto eYbvL; odZdX: if ($this->wm_vrt_alignment === "\x4d") { $y_axis += $this->orig_height / 2 - $wm_height / 2; } elseif ($this->wm_vrt_alignment === "\102") { $y_axis += $this->orig_height - $wm_height; } goto N6znW; nPViW: if ($this->wm_hor_alignment === "\x52") { $this->wm_hor_offset = $this->wm_hor_offset * -1; } goto FM01L; lxxYV: imagedestroy($src_img); goto MKF1h; eYbvL: } public function text_watermark() { goto XK0y7; cZto1: if ($this->wm_use_truetype) { imagettftext($src_img, $this->wm_font_size, 0, $x_axis, $y_axis, $txt_color, $this->wm_font_path, $this->wm_text); } else { imagestring($src_img, $this->wm_font_size, $x_axis, $y_axis, $this->wm_text, $txt_color); } goto UHAFG; r6bTL: $txt_color = str_split(substr($this->wm_font_color, 1, 6), 2); goto Pp8Ft; D3vaU: if ($this->dynamic_output === TRUE) { $this->image_display_gd($src_img); } else { $this->image_save_gd($src_img); } goto AvPAT; fPNzg: if ($this->wm_hor_alignment === "\122") { $x_axis += $this->orig_width - $fontwidth * strlen($this->wm_text) - $this->wm_shadow_distance; } elseif ($this->wm_hor_alignment === "\103") { $x_axis += floor(($this->orig_width - $fontwidth * strlen($this->wm_text)) / 2); } goto vgdLJ; vgdLJ: if ($this->wm_use_drop_shadow) { goto v_Iv1; cbDU_: $drp_color = imagecolorclosest($src_img, hexdec($drp_color[0]), hexdec($drp_color[1]), hexdec($drp_color[2])); goto b59qL; fHz3h: $y_shad = $y_axis + $this->wm_shadow_distance; goto SnR5s; v_Iv1: $x_shad = $x_axis + $this->wm_shadow_distance; goto fHz3h; SnR5s: $drp_color = str_split(substr($this->wm_shadow_color, 1, 6), 2); goto cbDU_; b59qL: if ($this->wm_use_truetype) { imagettftext($src_img, $this->wm_font_size, 0, $x_shad, $y_shad, $drp_color, $this->wm_font_path, $this->wm_text); } else { imagestring($src_img, $this->wm_font_size, $x_shad, $y_shad, $this->wm_text, $drp_color); } goto FQt5v; FQt5v: } goto r6bTL; MEt6v: if ($this->wm_use_truetype === TRUE && !file_exists($this->wm_font_path)) { $this->set_error("\x69\x6d\x67\x6c\x69\142\137\x6d\x69\x73\x73\x69\156\147\x5f\146\x6f\156\164"); return FALSE; } goto qjBkY; UHAFG: if ($this->image_type === 3) { imagealphablending($src_img, FALSE); imagesavealpha($src_img, TRUE); } goto D3vaU; uZIj3: $x_axis = $this->wm_hor_offset + $this->wm_padding; goto g0V_h; IkJsa: return TRUE; goto AvndO; d9OOl: $this->wm_hor_alignment = strtoupper($this->wm_hor_alignment[0]); goto YDsWC; ps7qW: if ($this->wm_use_truetype === TRUE) { goto R3ZMc; II2JE: $this->wm_vrt_offset += $this->wm_font_size; goto WWw3_; kqf5S: if (function_exists("\x69\x6d\x61\x67\x65\164\x74\146\x62\x62\x6f\x78")) { goto GN7zP; GN7zP: $temp = imagettfbbox($this->wm_font_size, 0, $this->wm_font_path, $this->wm_text); goto r3ArC; Kg7N8: $fontwidth = $temp / strlen($this->wm_text); goto TKSn2; r3ArC: $temp = $temp[2] - $temp[0]; goto Kg7N8; TKSn2: } else { $fontwidth = $this->wm_font_size - $this->wm_font_size / 4; } goto WbbbT; WbbbT: $fontheight = $this->wm_font_size; goto II2JE; R3ZMc: if (empty($this->wm_font_size)) { $this->wm_font_size = 17; } goto kqf5S; WWw3_: } else { $fontwidth = imagefontwidth($this->wm_font_size); $fontheight = imagefontheight($this->wm_font_size); } goto uZIj3; AvPAT: imagedestroy($src_img); goto IkJsa; g0V_h: $y_axis = $this->wm_vrt_offset + $this->wm_padding; goto blfNL; YDsWC: if ($this->wm_vrt_alignment === "\115") { $y_axis += $this->orig_height / 2 + $fontheight / 2; } elseif ($this->wm_vrt_alignment === "\x42") { $y_axis += $this->orig_height - $fontheight - $this->wm_shadow_distance - $fontheight / 2; } goto fPNzg; Pp8Ft: $txt_color = imagecolorclosest($src_img, hexdec($txt_color[0]), hexdec($txt_color[1]), hexdec($txt_color[2])); goto cZto1; BBLK_: if ($this->wm_hor_alignment === "\122") { $this->wm_hor_offset = $this->wm_hor_offset * -1; } goto ps7qW; vWBF3: if ($this->wm_vrt_alignment === "\102") { $this->wm_vrt_offset = $this->wm_vrt_offset * -1; } goto BBLK_; XK0y7: if (!($src_img = $this->image_create_gd())) { return FALSE; } goto MEt6v; qjBkY: $this->get_image_properties(); goto vWBF3; blfNL: if ($this->wm_use_drop_shadow === FALSE) { $this->wm_shadow_distance = 0; } goto wxH8J; wxH8J: $this->wm_vrt_alignment = strtoupper($this->wm_vrt_alignment[0]); goto d9OOl; AvndO: } public function image_create_gd($path = '', $image_type = '') { goto XV6hE; QcSDN: switch ($image_type) { case 1: if (!function_exists("\x69\155\141\147\x65\143\162\x65\141\164\x65\x66\162\x6f\155\147\151\x66")) { $this->set_error(array("\x69\x6d\x67\x6c\151\x62\x5f\x75\x6e\x73\x75\x70\x70\x6f\x72\x74\x65\144\x5f\151\x6d\x61\147\x65\143\x72\x65\x61\x74\145", "\151\155\x67\x6c\x69\142\x5f\x67\x69\146\137\156\x6f\x74\137\x73\x75\160\x70\157\162\164\145\144")); return FALSE; } return imagecreatefromgif($path); case 2: if (!function_exists("\151\x6d\141\x67\145\x63\x72\x65\141\164\145\146\162\x6f\x6d\x6a\x70\x65\147")) { $this->set_error(array("\151\x6d\x67\154\x69\142\137\x75\x6e\163\x75\x70\x70\x6f\162\x74\145\x64\137\x69\x6d\x61\147\145\x63\x72\145\x61\x74\x65", "\151\155\147\x6c\151\142\137\x6a\x70\x67\137\156\x6f\x74\137\163\x75\x70\160\157\x72\x74\145\x64")); return FALSE; } return imagecreatefromjpeg($path); case 3: if (!function_exists("\151\x6d\141\x67\145\x63\162\x65\x61\x74\145\146\162\157\155\x70\x6e\x67")) { $this->set_error(array("\151\x6d\x67\154\x69\x62\137\165\x6e\163\165\x70\160\x6f\x72\x74\x65\144\x5f\151\155\141\x67\x65\143\162\145\141\x74\x65", "\151\155\147\154\151\142\x5f\x70\156\x67\137\x6e\x6f\x74\x5f\163\165\x70\x70\x6f\162\x74\x65\x64")); return FALSE; } return imagecreatefrompng($path); default: $this->set_error(array("\x69\155\x67\154\x69\142\x5f\165\x6e\x73\165\160\160\157\162\164\145\x64\x5f\x69\155\141\x67\x65\143\162\x65\x61\x74\x65")); return FALSE; } goto BnIX6; nbDg2: if ($image_type === '') { $image_type = $this->image_type; } goto QcSDN; XV6hE: if ($path === '') { $path = $this->full_src_path; } goto nbDg2; BnIX6: } public function image_save_gd($resource) { switch ($this->image_type) { case 1: goto dPRfm; dPRfm: if (!function_exists("\x69\x6d\141\x67\145\147\151\146")) { $this->set_error(array("\x69\x6d\147\x6c\x69\x62\x5f\x75\156\163\x75\x70\x70\157\162\x74\x65\x64\x5f\151\155\141\147\x65\x63\162\145\141\164\145", "\151\155\147\154\x69\142\x5f\147\151\x66\137\x6e\x6f\x74\x5f\x73\165\160\160\157\162\x74\x65\x64")); return FALSE; } goto VgI6E; VgI6E: if (!@imagegif($resource, $this->full_dst_path)) { $this->set_error("\x69\155\147\154\151\x62\137\x73\x61\x76\145\137\x66\141\x69\x6c\145\x64"); return FALSE; } goto twJAS; twJAS: break; goto LGb5v; LGb5v: case 2: goto NYLIl; NYLIl: if (!function_exists("\151\155\141\147\145\x6a\x70\x65\x67")) { $this->set_error(array("\151\155\x67\x6c\151\x62\137\165\156\163\165\160\160\157\x72\x74\145\144\x5f\x69\155\141\x67\x65\143\x72\145\x61\x74\145", "\x69\x6d\147\154\151\x62\137\152\160\147\137\156\x6f\x74\137\163\165\x70\x70\157\162\164\x65\144")); return FALSE; } goto BmR3n; BmR3n: if (!@imagejpeg($resource, $this->full_dst_path, $this->quality)) { $this->set_error("\x69\x6d\147\x6c\151\142\137\x73\141\166\x65\137\x66\141\x69\154\x65\x64"); return FALSE; } goto tulIJ; tulIJ: break; goto Or3xW; Or3xW: case 3: goto SW_9Y; SW_9Y: if (!function_exists("\151\155\x61\x67\145\160\156\x67")) { $this->set_error(array("\151\155\x67\154\x69\x62\137\x75\x6e\163\x75\x70\x70\157\x72\x74\x65\144\x5f\x69\155\141\x67\x65\143\x72\x65\x61\164\x65", "\x69\155\147\154\x69\142\x5f\x70\156\x67\x5f\x6e\x6f\x74\x5f\163\165\x70\x70\x6f\162\x74\145\144")); return FALSE; } goto LQhoQ; L0KEC: break; goto noYEZ; LQhoQ: if (!@imagepng($resource, $this->full_dst_path)) { $this->set_error("\x69\x6d\x67\154\151\142\x5f\163\141\x76\x65\137\x66\x61\151\x6c\x65\144"); return FALSE; } goto L0KEC; noYEZ: default: goto PRxYn; O0gt6: return FALSE; goto NvgS2; PRxYn: $this->set_error(array("\x69\155\147\154\x69\142\x5f\x75\x6e\x73\165\x70\x70\x6f\162\164\x65\144\137\x69\x6d\141\x67\145\x63\x72\145\141\164\145")); goto O0gt6; NvgS2: break; goto Il0jF; Il0jF: } return TRUE; } public function image_display_gd($resource) { goto gwBQl; gU5nh: header("\x43\157\156\x74\145\x6e\x74\x2d\124\162\x61\156\163\146\x65\x72\x2d\105\x6e\143\x6f\x64\x69\x6e\x67\72\40\142\x69\156\141\162\x79"); goto upbL1; upbL1: header("\114\141\x73\x74\55\x4d\157\x64\151\x66\x69\x65\x64\x3a\40" . gmdate("\x44\x2c\40\x64\40\115\x20\131\40\x48\x3a\x69\x3a\163", time()) . "\40\107\x4d\x54"); goto R5IXZ; R5IXZ: switch ($this->image_type) { case 1: imagegif($resource); break; case 2: imagejpeg($resource, NULL, $this->quality); break; case 3: imagepng($resource); break; default: echo "\x55\x6e\x61\142\x6c\145\40\164\x6f\40\x64\x69\163\x70\x6c\x61\x79\40\x74\x68\145\x20\151\155\141\147\x65"; break; } goto U8YUb; DyYmm: header("\103\x6f\x6e\164\145\156\164\55\x54\x79\x70\145\72\40" . $this->mime_type); goto gU5nh; gwBQl: header("\x43\157\156\x74\x65\156\164\x2d\104\151\163\160\x6f\163\x69\164\151\x6f\x6e\72\x20\146\151\154\145\156\x61\155\x65\75" . $this->source_image . "\x3b"); goto DyYmm; U8YUb: } public function image_reproportion() { goto Dwl8R; FlGOR: $this->height = (int) $this->height; goto lp90Y; w0FkU: if ($this->master_dim === "\x77\x69\x64\x74\x68") { $this->height = (int) ceil($this->width * $this->orig_height / $this->orig_width); } else { $this->width = (int) ceil($this->orig_width * $this->height / $this->orig_height); } goto evmUs; lp90Y: if ($this->master_dim !== "\x77\x69\x64\x74\150" && $this->master_dim !== "\150\145\x69\147\x68\x74") { if ($this->width > 0 && $this->height > 0) { $this->master_dim = $this->orig_height / $this->orig_width - $this->height / $this->width < 0 ? "\x77\x69\144\164\150" : "\150\x65\151\x67\150\x74"; } else { $this->master_dim = $this->height === 0 ? "\167\x69\x64\164\150" : "\150\145\x69\x67\150\x74"; } } elseif ($this->master_dim === "\167\x69\x64\164\150" && $this->width === 0 or $this->master_dim === "\x68\145\x69\147\150\164" && $this->height === 0) { return; } goto w0FkU; xdsPw: $this->width = (int) $this->width; goto FlGOR; Dwl8R: if ($this->width === 0 && $this->height === 0 or $this->orig_width === 0 or $this->orig_height === 0 or !ctype_digit((string) $this->width) && !ctype_digit((string) $this->height) or !ctype_digit((string) $this->orig_width) or !ctype_digit((string) $this->orig_height)) { return; } goto xdsPw; evmUs: } public function get_image_properties($path = '', $return = FALSE) { goto tDnJ8; tDnJ8: if ($path === '') { $path = $this->full_src_path; } goto jT0OX; uwbZv: $types = array(1 => "\147\151\x66", 2 => "\152\160\145\147", 3 => "\x70\156\x67"); goto nnC29; jT0OX: if (!file_exists($path)) { $this->set_error("\x69\155\x67\x6c\x69\142\137\x69\x6e\x76\141\x6c\151\144\137\160\x61\164\x68"); return FALSE; } goto YpPwI; YpPwI: $vals = getimagesize($path); goto BO4wT; S3f2v: $this->size_str = $vals[3]; goto SOmjd; KoA84: $this->orig_height = $vals[1]; goto EjrmF; EjrmF: $this->image_type = $vals[2]; goto S3f2v; x5oya: if ($return === TRUE) { return array("\x77\151\x64\164\150" => $vals[0], "\x68\x65\151\147\150\164" => $vals[1], "\151\x6d\x61\x67\x65\137\x74\171\x70\145" => $vals[2], "\163\151\x7a\x65\137\x73\164\x72" => $vals[3], "\155\151\x6d\145\x5f\x74\171\x70\x65" => $mime); } goto NvkY3; neDi0: return TRUE; goto EuThp; SOmjd: $this->mime_type = $mime; goto neDi0; BO4wT: if ($vals === FALSE) { $this->set_error("\151\155\147\x6c\x69\x62\137\x69\x6e\166\141\x6c\x69\144\137\151\x6d\x61\x67\x65"); return FALSE; } goto uwbZv; nnC29: $mime = isset($types[$vals[2]]) ? "\151\x6d\141\147\145\x2f" . $types[$vals[2]] : "\x69\155\x61\147\145\x2f\x6a\160\147"; goto x5oya; NvkY3: $this->orig_width = $vals[0]; goto KoA84; EuThp: } public function size_calculator($vals) { goto jkm_Y; H0A1F: if ($vals["\167\x69\144\164\x68"] === 0 or $vals["\150\145\x69\147\150\164"] === 0) { return $vals; } goto aoMCT; aoMCT: if ($vals["\x6e\145\x77\137\x77\x69\x64\x74\150"] === 0) { $vals["\156\145\x77\x5f\167\151\144\164\x68"] = ceil($vals["\167\151\x64\164\x68"] * $vals["\156\x65\167\137\x68\x65\151\147\x68\164"] / $vals["\x68\145\151\147\150\x74"]); } elseif ($vals["\x6e\145\x77\x5f\150\x65\151\147\x68\x74"] === 0) { $vals["\x6e\145\x77\x5f\150\145\151\x67\150\x74"] = ceil($vals["\x6e\x65\167\x5f\x77\x69\144\164\150"] * $vals["\150\145\x69\x67\150\x74"] / $vals["\x77\151\x64\164\150"]); } goto Lik4T; jkm_Y: if (!is_array($vals)) { return; } goto sS69t; sS69t: $allowed = array("\156\145\167\137\x77\x69\144\164\150", "\x6e\x65\167\x5f\x68\145\151\x67\x68\x74", "\x77\151\144\164\150", "\x68\145\x69\147\x68\x74"); goto ksL2A; ksL2A: foreach ($allowed as $item) { if (empty($vals[$item])) { $vals[$item] = 0; } } goto H0A1F; Lik4T: return $vals; goto rXWig; rXWig: } public function explode_name($source_image) { goto nXE_u; IHeYf: return array("\x65\x78\x74" => $ext, "\x6e\x61\155\x65" => $name); goto aC9Rd; Bt6nQ: $name = $ext === FALSE ? $source_image : substr($source_image, 0, -strlen($ext)); goto IHeYf; nXE_u: $ext = strrchr($source_image, "\x2e"); goto Bt6nQ; aC9Rd: } public function gd_loaded() { if (!extension_loaded("\147\x64")) { return function_exists("\x64\154") && @dl("\x67\x64\x2e\163\x6f"); } return TRUE; } public function gd_version() { if (function_exists("\147\144\x5f\x69\x6e\146\x6f")) { $gd_version = @gd_info(); return preg_replace("\57\134\104\x2f", '', $gd_version["\107\x44\40\x56\145\162\x73\x69\x6f\x6e"]); } return FALSE; } public function set_error($msg) { goto doGhv; D2iMx: if (is_array($msg)) { foreach ($msg as $val) { goto jXimz; JQWDP: log_message("\x65\162\x72\157\x72", $msg); goto Dmq00; jXimz: $msg = $CI->lang->line($val) === FALSE ? $val : $CI->lang->line($val); goto Rcli_; Rcli_: $this->error_msg[] = $msg; goto JQWDP; Dmq00: } } else { goto I_jqD; I_jqD: $msg = $CI->lang->line($msg) === FALSE ? $msg : $CI->lang->line($msg); goto TnN1a; IA4wH: log_message("\145\x72\162\x6f\x72", $msg); goto xaylE; TnN1a: $this->error_msg[] = $msg; goto IA4wH; xaylE: } goto c4oo0; qgZFx: $CI->lang->load("\151\155\x67\x6c\x69\x62"); goto D2iMx; doGhv: $CI =& get_instance(); goto qgZFx; c4oo0: } public function display_errors($open = "\74\160\x3e", $close = "\x3c\57\160\76") { return count($this->error_msg) > 0 ? $open . implode($close . $open, $this->error_msg) . $close : ''; } }
