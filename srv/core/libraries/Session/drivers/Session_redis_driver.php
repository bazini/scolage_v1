<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.14  |
    |              on 2024-09-11 13:11:17              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*

*/
 defined("\102\101\x53\x45\x50\x41\x54\110") or exit("\x4e\x6f\40\x64\151\x72\145\143\164\40\163\143\x72\x69\x70\164\x20\x61\143\x63\x65\163\163\x20\x61\154\x6c\x6f\x77\x65\x64"); class CI_Session_redis_driver extends CI_Session_driver implements SessionHandlerInterface { protected $_redis; protected $_key_prefix = "\143\151\x5f\x73\145\163\163\151\x6f\156\x3a"; protected $_lock_key; protected $_key_exists = FALSE; protected $_setTimeout_name; protected $_delete_name; protected $_ping_success; public function __construct(&$params) { goto qOkPa; JOVAf: if (version_compare(phpversion("\162\145\144\x69\x73"), "\65", "\x3e\75")) { goto Mfnqk; j2eEx: $this->_ping_success = TRUE; goto bDgK2; M2MFT: $this->_delete_name = "\144\x65\x6c"; goto j2eEx; Mfnqk: $this->_setTimeout_name = "\x65\x78\160\151\x72\145"; goto M2MFT; bDgK2: } else { goto XGQiE; XGQiE: $this->_setTimeout_name = "\163\145\x74\124\x69\x6d\145\157\x75\164"; goto vzXKg; P7glQ: $this->_ping_success = "\53\120\117\116\107"; goto nC2zJ; vzXKg: $this->_delete_name = "\144\145\154\x65\x74\x65"; goto P7glQ; nC2zJ: } goto vpjf5; qOkPa: parent::__construct($params); goto JOVAf; vpjf5: if (empty($this->_config["\163\x61\x76\145\x5f\160\141\x74\150"])) { log_message("\x65\162\162\x6f\x72", "\123\145\163\x73\x69\x6f\156\x3a\x20\x4e\157\x20\122\x65\x64\151\x73\40\163\x61\166\145\x20\x70\141\x74\x68\x20\143\157\x6e\x66\x69\147\165\x72\145\x64\x2e"); } elseif (preg_match("\x23\50\x3f\72\164\x63\160\x3a\57\57\x29\77\50\x5b\x5e\x3a\x3f\x5d\x2b\x29\50\x3f\x3a\x5c\x3a\50\x5c\x64\53\x29\x29\77\50\134\77\56\x2b\51\x3f\x23", $this->_config["\163\141\x76\145\137\160\x61\164\x68"], $matches)) { goto iAVdD; ruZcM: preg_match("\43\160\x72\145\x66\x69\x78\x3d\x28\x5b\x5e\134\163\x26\135\x2b\x29\43", $matches[3], $match) && ($this->_key_prefix = $match[1]); goto B5ARz; iAVdD: isset($matches[3]) or $matches[3] = ''; goto Z2hHt; Z2hHt: $this->_config["\163\x61\166\x65\137\x70\x61\x74\x68"] = array("\x68\157\x73\x74" => $matches[1], "\x70\x6f\x72\x74" => empty($matches[2]) ? NULL : $matches[2], "\x70\x61\x73\163\x77\x6f\x72\x64" => preg_match("\x23\141\x75\x74\150\x3d\x28\x5b\x5e\x5c\x73\46\135\53\x29\x23", $matches[3], $match) ? $match[1] : NULL, "\x64\x61\164\141\x62\x61\163\x65" => preg_match("\43\144\x61\164\x61\142\x61\x73\145\x3d\x28\x5c\144\x2b\51\43", $matches[3], $match) ? (int) $match[1] : NULL, "\164\x69\x6d\145\x6f\165\164" => preg_match("\43\164\x69\x6d\x65\157\165\164\75\x28\134\144\x2b\x5c\56\134\144\x2b\x29\43", $matches[3], $match) ? (float) $match[1] : NULL); goto ruZcM; B5ARz: } else { log_message("\145\x72\x72\157\x72", "\123\145\163\x73\151\157\x6e\72\40\111\x6e\x76\x61\x6c\151\144\40\x52\x65\144\x69\x73\40\x73\x61\166\145\x20\x70\x61\x74\150\40\146\157\162\155\141\164\x3a\x20" . $this->_config["\x73\x61\166\x65\x5f\160\x61\x74\x68"]); } goto YBWqI; YBWqI: if ($this->_config["\x6d\x61\164\x63\150\137\x69\x70"] === TRUE) { $this->_key_prefix .= $_SERVER["\122\x45\x4d\x4f\124\x45\137\x41\x44\x44\x52"] . "\x3a"; } goto MeJk6; MeJk6: } public function open($save_path, $name) { goto f0Hmy; TZdfD: if (!$redis->connect($this->_config["\x73\141\166\145\x5f\160\x61\164\150"]["\x68\157\x73\164"], $this->_config["\x73\x61\x76\145\137\x70\141\x74\x68"]["\x70\157\162\164"], $this->_config["\x73\141\166\145\x5f\x70\x61\164\150"]["\164\151\155\x65\157\165\x74"])) { log_message("\145\162\x72\x6f\162", "\x53\145\x73\163\x69\157\156\72\x20\125\156\141\142\x6c\145\x20\x74\157\x20\143\x6f\156\x6e\145\143\164\x20\x74\x6f\x20\122\145\144\151\x73\40\167\151\164\150\40\x74\x68\x65\x20\143\x6f\x6e\x66\151\147\165\x72\145\144\40\163\x65\x74\164\151\x6e\x67\x73\56"); } elseif (isset($this->_config["\163\x61\x76\x65\x5f\x70\x61\x74\150"]["\160\x61\163\x73\x77\157\162\144"]) && !$redis->auth($this->_config["\163\x61\166\x65\137\x70\141\164\x68"]["\x70\x61\x73\163\x77\157\x72\144"])) { log_message("\x65\x72\162\157\x72", "\123\x65\x73\x73\151\x6f\x6e\x3a\40\125\x6e\141\142\154\x65\40\x74\157\40\x61\x75\x74\150\145\x6e\x74\151\x63\x61\164\145\40\x74\x6f\40\x52\145\144\151\x73\40\151\x6e\x73\x74\x61\x6e\143\x65\56"); } elseif (isset($this->_config["\163\141\x76\145\x5f\x70\x61\164\150"]["\144\x61\x74\x61\x62\x61\x73\x65"]) && !$redis->select($this->_config["\163\141\x76\x65\137\x70\141\164\x68"]["\144\141\164\141\142\141\163\x65"])) { log_message("\145\x72\162\157\x72", "\123\145\x73\163\x69\x6f\156\72\40\125\156\141\142\154\x65\40\x74\157\x20\x73\145\154\145\x63\x74\40\122\x65\x64\151\x73\40\x64\x61\164\x61\x62\141\163\145\40\167\x69\x74\x68\x20\x69\x6e\144\145\x78\40" . $this->_config["\x73\x61\166\x65\137\160\141\x74\x68"]["\x64\x61\164\x61\142\x61\163\145"]); } else { goto d5vBv; V1RUc: return $this->_success; goto dZGjr; d5vBv: $this->_redis = $redis; goto nh4YS; nh4YS: $this->php5_validate_id(); goto V1RUc; dZGjr: } goto qqGwv; f0Hmy: if (empty($this->_config["\163\x61\166\145\137\160\141\164\150"])) { return $this->_failure; } goto CJhwP; CJhwP: $redis = new Redis(); goto TZdfD; qqGwv: return $this->_failure; goto QWzvT; QWzvT: } public function read($session_id) { if (isset($this->_redis) && $this->_get_lock($session_id)) { goto VyaFW; xECjl: is_string($session_data) ? $this->_key_exists = TRUE : ($session_data = ''); goto XLyZh; VyaFW: $this->_session_id = $session_id; goto BE9Vt; XLyZh: $this->_fingerprint = md5($session_data); goto oAF_E; oAF_E: return $session_data; goto m3B1j; BE9Vt: $session_data = $this->_redis->get($this->_key_prefix . $session_id); goto xECjl; m3B1j: } return $this->_failure; } public function write($session_id, $session_data) { goto ri83f; MP02E: return $this->_redis->{$this->_setTimeout_name}($this->_key_prefix . $session_id, $this->_config["\145\170\160\151\162\x61\x74\x69\x6f\156"]) ? $this->_success : $this->_failure; goto M4iP5; ri83f: if (!isset($this->_redis, $this->_lock_key)) { return $this->_failure; } elseif ($session_id !== $this->_session_id) { goto dAxXU; nKJot: $this->_key_exists = FALSE; goto X52C0; dAxXU: if (!$this->_release_lock() or !$this->_get_lock($session_id)) { return $this->_failure; } goto nKJot; X52C0: $this->_session_id = $session_id; goto uchBT; uchBT: } goto slb26; slb26: $this->_redis->{$this->_setTimeout_name}($this->_lock_key, 300); goto VRD4h; VRD4h: if ($this->_fingerprint !== ($fingerprint = md5($session_data)) or $this->_key_exists === FALSE) { if ($this->_redis->set($this->_key_prefix . $session_id, $session_data, $this->_config["\145\170\x70\151\x72\141\x74\x69\x6f\x6e"])) { goto CGQw_; CGQw_: $this->_fingerprint = $fingerprint; goto OVFFx; OVFFx: $this->_key_exists = TRUE; goto pAZm8; pAZm8: return $this->_success; goto zbIWb; zbIWb: } return $this->_failure; } goto MP02E; M4iP5: } public function close() { if (isset($this->_redis)) { goto OBYA7; u2xGn: return $this->_success; goto uetIP; KhG60: $this->_redis = NULL; goto u2xGn; OBYA7: try { if ($this->_redis->ping() === $this->_ping_success) { $this->_release_lock(); if ($this->_redis->close() === FALSE) { return $this->_failure; } } } catch (RedisException $e) { log_message("\145\162\x72\x6f\162", "\123\x65\163\x73\x69\157\156\x3a\x20\x47\x6f\x74\40\122\145\x64\x69\163\105\170\143\145\x70\x74\x69\x6f\156\40\x6f\x6e\x20\143\x6c\157\163\x65\x28\51\72\40" . $e->getMessage()); } goto KhG60; uetIP: } return $this->_success; } public function destroy($session_id) { if (isset($this->_redis, $this->_lock_key)) { goto hTe0F; hTe0F: if (($result = $this->_redis->{$this->_delete_name}($this->_key_prefix . $session_id)) !== 1) { log_message("\144\x65\142\165\147", "\x53\145\163\163\x69\157\x6e\x3a\x20\122\x65\x64\x69\x73\72\72" . $this->_delete_name . "\50\51\x20\x65\170\160\145\143\164\145\144\x20\x74\157\x20\x72\145\164\165\x72\156\x20\x31\54\x20\x67\157\164\40" . var_export($result, TRUE) . "\x20\x69\156\x73\164\x65\141\144\x2e"); } goto RQ163; RQ163: $this->_cookie_destroy(); goto W5Z_j; W5Z_j: return $this->_success; goto zmGVf; zmGVf: } return $this->_failure; } public function gc($maxlifetime) { return $this->_success; } public function validateSessionId($id) { return (bool) $this->_redis->exists($this->_key_prefix . $id); } protected function _get_lock($session_id) { goto oJETs; FTrDz: $attempt = 0; goto DjsJ2; vI3g1: $this->_lock = TRUE; goto gIAx4; TViIr: if ($attempt === 30) { log_message("\145\162\x72\x6f\x72", "\123\x65\x73\x73\151\157\156\72\x20\125\x6e\x61\x62\154\145\x20\164\157\x20\157\x62\x74\x61\x69\x6e\x20\154\157\143\x6b\x20\146\157\x72\x20" . $this->_key_prefix . $session_id . "\40\141\146\x74\x65\x72\40\63\60\40\x61\x74\x74\x65\x6d\x70\x74\163\x2c\40\141\x62\157\162\x74\151\156\x67\x2e"); return FALSE; } elseif ($ttl === -1) { log_message("\144\145\142\165\147", "\x53\x65\x73\163\x69\157\156\72\40\x4c\157\143\153\x20\146\x6f\x72\x20" . $this->_key_prefix . $session_id . "\x20\150\x61\144\x20\x6e\x6f\x20\x54\124\114\54\40\x6f\166\x65\x72\162\151\x64\x69\156\147\x2e"); } goto vI3g1; oJETs: if ($this->_lock_key === $this->_key_prefix . $session_id . "\x3a\154\157\143\x6b") { return $this->_redis->{$this->_setTimeout_name}($this->_lock_key, 300); } goto U0wgO; gIAx4: return TRUE; goto cTE79; U0wgO: $lock_key = $this->_key_prefix . $session_id . "\x3a\154\157\143\153"; goto FTrDz; DjsJ2: do { if (($ttl = $this->_redis->ttl($lock_key)) > 0) { sleep(1); continue; } if ($ttl === -2 && !$this->_redis->set($lock_key, time(), array("\x6e\170", "\x65\170" => 300))) { sleep(1); continue; } elseif (!$this->_redis->setex($lock_key, 300, time())) { log_message("\x65\x72\162\x6f\x72", "\x53\x65\x73\163\151\157\156\72\x20\105\162\162\x6f\162\40\x77\x68\x69\154\x65\40\164\162\x79\151\x6e\147\40\164\157\40\x6f\142\x74\x61\x69\156\x20\x6c\157\x63\x6b\40\146\157\x72\x20" . $this->_key_prefix . $session_id); return FALSE; } $this->_lock_key = $lock_key; break; } while (++$attempt < 30); goto TViIr; cTE79: } protected function _release_lock() { if (isset($this->_redis, $this->_lock_key) && $this->_lock) { goto GzQSG; SCRSO: $this->_lock = FALSE; goto j0Dtc; GzQSG: if (!$this->_redis->{$this->_delete_name}($this->_lock_key)) { log_message("\x65\162\162\157\162", "\x53\x65\x73\163\x69\157\x6e\x3a\40\105\162\x72\157\x72\40\167\x68\x69\154\145\x20\164\x72\x79\151\156\x67\x20\x74\x6f\x20\146\162\145\145\40\154\157\143\x6b\40\x66\157\162\x20" . $this->_lock_key); return FALSE; } goto yxW5T; yxW5T: $this->_lock_key = NULL; goto SCRSO; j0Dtc: } return TRUE; } }
