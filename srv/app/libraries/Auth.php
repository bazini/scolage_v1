<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator  2.0.14  |
    |              on 2024-09-11 13:11:18              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
/*

*/
 defined("\x42\x41\123\x45\120\101\x54\x48") or exit("\x4e\157\40\144\151\162\x65\143\x74\40\x73\x63\162\151\x70\x74\40\x61\x63\143\x65\x73\163\x20\x61\154\154\x6f\x77\145\144"); class Auth { protected $CI; private $session; private $input; private $mydb; private $user; private $encryption; private $table; private $uvar; private $sysvar; private $id; private $mdate; private $control; private $agent; private $group; public function __construct() { goto b3r2K; b3r2K: $this->CI =& get_instance(); goto H5_IE; o85dW: $this->table = "\x75\x73\x65\162\163"; goto GBFA_; htxx4: $this->input =& $this->CI->input; goto iPUrW; Q5zaQ: $this->mydb =& $this->CI->mydb; goto E2e8w; fVhay: $this->encryption =& $this->CI->encryption; goto z89lp; GBFA_: $this->uvar = "\x75\x73\145\x72\x5f\166\x61\162\151\x61\x62\154\145\x73"; goto yb9VF; z89lp: $this->group =& $this->CI->group; goto o85dW; yb9VF: $this->sysvar = "\163\x79\x73\164\x65\155\x5f\x76\x61\162\x69\x61\x62\x6c\x65\163"; goto aX3K3; H5_IE: $this->session =& $this->CI->session; goto htxx4; iPUrW: $this->agent =& $this->CI->agent; goto Q5zaQ; E2e8w: $this->user =& $this->CI->users; goto XcyD0; Kd33E: $this->mdate = gmdate("\x59\55\x6d\x2d\x64\x20\x48\x3a\151\x3a\163"); goto CozAz; XcyD0: $this->control =& $this->CI->control; goto fVhay; aX3K3: $this->id = $this->session->userdata("\151\x64"); goto Kd33E; CozAz: } public function login($id, $mdp, $rem) { goto GYg2C; vu28u: return $d; goto hilJH; DiQc_: if ($u["\145\x72\162\x6f\162"] == false) { $user = $u["\x64\x61\x74\x61"]; if (!$this->user->can_login($user->id)) { if ($user->banned == 0) { $pass = hash_password($mdp, $user->id); if ($user->pass == $pass) { if ($user->login_attempts >= 4) { $d["\x65\162\x6d\x73\147"] = "\126\x6f\164\x72\x65\x20\x63\x6f\x6d\x70\164\145\40\145\x73\164\40\x62\x6c\157\x71\x75\303\251\x2e\x20\126\x65\x75\151\x6c\154\145\x7a\x20\143\157\156\x74\141\143\x74\145\x72\x20\x75\x6e\40\141\144\155\x69\156\x69\163\164\162\141\164\145\165\162\x20\x64\x65\x20\x6c\47\x61\160\x70\x6c\151\143\x61\x74\x69\x6f\156"; } else { goto ycvxy; ycvxy: $d["\x65\162\162\x6f\162"] = false; goto SZXXq; SZXXq: $this->set_session($u["\144\141\x74\141"]); goto U1xJ9; BbKUt: $this->reset_login_attempts($user->id); goto sasig; sasig: $d["\144\145\163\x74"] = $this->get_dest($user->id); goto OmmXJ; U1xJ9: if ($rem == true) { $this->remind_password($user->id); } goto wjM7i; wjM7i: $this->update_activity($user->id); goto CLZlk; CLZlk: $this->update_last_login($user->id); goto BbKUt; OmmXJ: $d["\x69\144"] = $user->id; goto t1bBL; t1bBL: } } else { $is_admin = $this->control->is_admin($user->id); if ($is_admin) { $d["\145\x72\155\x73\x67"] = "\x4d\x6f\164\40\x64\x65\40\x70\x61\x73\163\145\x20\151\x6e\143\x6f\x72\x72\145\x63\x74"; } else { goto ZvalD; ZvalD: $nb = $this->update_login_attempts($user->id); goto y7zse; y7zse: $n = 4 - $nb; goto pCgNS; pCgNS: if ($n <= 0) { $this->mydb->update("\165\x73\145\162\x73", array("\x62\141\156\x6e\x65\144" => 1), array("\x69\144" => $user->id)); $d["\145\162\x6d\163\147"] = "\126\x6f\x74\x72\x65\x20\143\157\x6d\160\164\x65\x20\145\163\x74\40\x62\154\x6f\x71\x75\303\xa9\56\40\126\x65\x75\x69\154\x6c\x65\172\x20\x63\x6f\156\164\x61\143\164\x65\162\40\x75\x6e\40\x61\144\155\x69\x6e\151\x73\164\162\x61\164\145\165\x72\40\x64\165\x20\163\x69\x74\x65"; } else { $d["\145\x72\x6d\x73\x67"] = "\115\157\x74\40\x64\145\40\x70\141\x73\x73\145\x20\151\x6e\x63\157\162\x72\145\x63\164\56\x20\105\156\143\157\162\x65\40{$n}\x20\x74\145\x6e\x74\141\x74\x69\x76\x65\x28\163\x29\x20\x70\157\x73\x73\x69\142\x6c\145"; } goto H6jox; H6jox: } } } else { $d["\x65\x72\155\163\x67"] = "\x56\x6f\164\x72\145\x20\x63\157\x6d\160\x74\145\x20\145\x73\x74\x20\142\154\x6f\161\165\303\251\x20\x73\165\151\x74\x65\40\303\xa0\40\165\x6e\x65\x20\x73\xc3\xa9\162\x69\145\x20\144\145\40\164\x65\x6e\164\x61\x74\x69\166\145\x73\40\151\x6e\x66\162\x75\x63\164\x75\145\x75\163\145\x73"; } } else { $d["\145\162\155\x73\x67"] = "\126\157\165\163\x20\156\x27\303\252\164\145\163\40\x70\x61\163\40\141\165\164\157\162\151\163\303\xa9\163\x20\303\xa0\40\x76\x6f\165\163\40\x63\x6f\156\x6e\x65\143\164\145\x72\x2e\x20\126\145\x75\151\x6c\x6c\145\x7a\x20\x63\x6f\156\164\x61\x63\x74\x65\162\x20\165\x6e\x20\141\144\155\x69\x6e\x69\x73\x74\x72\141\x74\145\165\x72\x20\144\x75\40\163\x69\164\x65"; } } else { $d["\145\x72\x6d\x73\x67"] = $u["\145\x72\x6d\163\x67"]; } goto vu28u; GYg2C: $d["\145\162\162\157\x72"] = true; goto KQotD; KQotD: $u = $this->user->get($id); goto DiQc_; hilJH: } public function is_loggedin() { if ($this->session->userdata("\x6c\x6f\147\x67\145\x64\x69\x6e")) { return true; } return false; } public function is_reminded() { goto Gqdbi; SJ4Qs: return $d; goto PIkVp; Gqdbi: $d = false; goto cOeZh; jAEDQ: if (!empty($cook)) { $d = $this->encryption->decrypt($cook); } goto SJ4Qs; cOeZh: $cook = $this->input->cookie("\x72\x65\x6d\151\x6e\x64"); goto jAEDQ; PIkVp: } public function login_fast($id) { goto fXzjm; MCsfC: if ($u["\145\x72\x72\x6f\162"] == false) { goto sQe5R; bvwSZ: $d["\x64\145\x73\x74"] = $this->get_dest($id); goto w8OGk; sQe5R: $this->set_session($u["\144\x61\164\141"]); goto QoCVK; QoCVK: $d["\x65\x72\162\157\162"] = false; goto bvwSZ; w8OGk: } else { $d["\145\162\x6d\163\147"] = $u["\145\x72\155\x73\147"]; } goto sOhlv; PHwtC: $u = $this->user->get($id); goto MCsfC; fXzjm: $d["\145\x72\x72\x6f\162"] = true; goto PHwtC; sOhlv: return $d; goto RRwag; RRwag: } public function logout() { goto i6vJT; i6vJT: $this->session->sess_destroy(); goto ORr3b; GYkGH: return $this; goto nG1If; ORr3b: $this->input->set_cookie("\x72\x65\155\151\156\x64", '', -3600 * 24 * 30, '', "\x2f"); goto GYkGH; nG1If: } public function reset_login_attempts($id = false) { if ($id == false) { $id = $this->id; } return $this->mydb->update($this->table, array("\154\157\147\x69\156\x5f\141\x74\164\145\x6d\160\164\x73" => 0), array("\151\144" => $id)); } public function remind_password($id) { $cook = $this->encryption->encrypt($id); $this->input->set_cookie("\162\145\155\151\156\x64", $cook, 3600 * 24 * 30, '', "\57"); } public function reset_password($pass, $id = false) { if ($id == false) { $id = $this->id; } return $this->mydb->update($this->table, array("\160\141\x73\x73" => $pass), array("\x69\x64" => $id)); } public function update_last_login($id) { return $this->mydb->update($this->table, array("\154\x61\x73\x74\x5f\154\x6f\x67\151\156" => $this->mdate), array("\x69\144" => $id)); } public function update_login_attempts($id) { goto ose_A; ohMNC: $this->set_login_attempts($id); goto J6LRz; EjwDJ: $this->mydb->update($this->table, array("\x6c\x61\163\x74\137\154\x6f\147\x69\156\x5f\x61\x74\164\145\x6d\x70\x74" => $this->mdate, "\154\x6f\x67\151\x6e\137\141\164\164\x65\x6d\160\164\163" => $nb), array("\151\144" => $id)); goto ohMNC; s5JW8: $nb = intval($lg->login_attempts) + 1; goto EjwDJ; ose_A: $lg = $this->mydb->get($this->table, array("\154\157\147\x69\156\137\141\164\164\x65\x6d\160\164\x73"), array("\x69\x64" => $id)); goto s5JW8; J6LRz: return $nb; goto u0swi; u0swi: } public function set_login_attempts($id) { $req = array("\165\163\145\x72" => $id, "\x64\145\x76\151\x63\x65" => $this->agent->is_mobile() ? $this->agent->mobile() : "\120\103", "\160\x6c\x61\x74\146\x6f\162\155" => $this->agent->platform(), "\142\x72\157\x77\x73\x65\x72" => $this->agent->browser() . "\40" . $this->agent->version(), "\x69\160" => $this->input->ip_address()); $this->mydb->set("\154\x6f\x67\151\156\x5f\x61\x74\x74\x65\x6d\160\164\163", $req); } public function update_activity($id = false) { if ($id == false) { $id = $this->id; } return $this->mydb->update($this->table, array("\154\141\163\164\137\x61\143\164\151\166\x69\x74\171" => $this->mdate), array("\151\144" => $id)); } public function sethistory($action) { return $this->mydb->set("\165\x73\x65\162\141\x63\x74\151\157\x6e", array("\x75\x73\x65\x72" => $this->session->userdata("\x69\144"), "\141\x63\x74\x69\x6f\x6e" => $action, "\x70\x6c\x61\164\x66\x6f\162\x6d" => $this->agent->platform(), "\x64\145\x76\x69\x63\x65" => $this->agent->is_mobile() ? $this->agent->mobile() : "\120\103", "\x62\162\x6f\x77\x73\145\162" => $this->agent->browser() . "\x20" . $this->agent->version(), "\151\x70" => $this->input->ip_address())); } public function get_user_vars($id = false) { goto zuJv1; Gi8mn: return $d; goto e2B8g; J_yfj: $d["\145\x72\162\x6f\162"] = true; goto wZmkl; wZmkl: $vars = $this->mydb->gets($this->uvar, array("\x60\x6b\145\x79\x60", "\166\141\x6c\165\x65"), array("\x75\163\x65\162\x5f\151\144" => $id)); goto nyfbu; nyfbu: if (!empty($vars)) { $d["\145\162\162\157\162"] = false; $d["\x64\x61\x74\141"] = $vars; } goto Gi8mn; zuJv1: if ($id == false) { $id = $this->id; } goto J_yfj; e2B8g: } public function get_user_var($key, $id = false) { goto nP1Zf; LuTQ9: $var = $this->mydb->get($this->uvar, array("\166\x61\x6c\x75\x65"), array("\165\x73\x65\x72\137\x69\144" => $id, "\x60\153\x65\171\x60" => $key)); goto XcwSG; nP1Zf: $d = false; goto aqHiz; XcwSG: if (!empty($var)) { $d = $var->value; } goto Oo8YF; aqHiz: if ($id == false) { $id = $this->session->userdata("\x69\x64"); } goto LuTQ9; Oo8YF: return $d; goto fGgJE; fGgJE: } public function set_user_var($key, $value = '', $id = false) { goto b83rm; b83rm: $d = false; goto rv9rM; rv9rM: if ($id == false) { $id = $this->session->userdata("\151\x64"); } goto LH6YR; NT2PF: if (!empty($res)) { $this->mydb->update($this->uvar, array("\166\x61\154\x75\145" => $value), array("\151\144" => $res->id)); $d = $res->id; } else { $d = $this->mydb->set($this->uvar, array("\165\163\x65\x72\x5f\x69\144" => $id, "\x6b\x65\x79" => $key, "\x76\x61\154\x75\x65" => $value)); } goto LN1ja; LH6YR: $res = $this->mydb->get($this->uvar, array("\x69\x64"), array("\165\x73\145\x72\137\151\144" => $id, "\x6b\x65\171" => $key)); goto NT2PF; LN1ja: return $d; goto k_IK2; k_IK2: } public function unset_user_var($key, $id = false) { goto V2iGl; ygY73: if (!empty($var)) { $d = $this->mydb->delete($this->uvar, array("\x75\163\145\x72\137\x69\x64" => $id, "\x60\153\145\x79\x60" => $key)); } goto MuFh1; V2iGl: $d = false; goto znaqt; znaqt: if ($id == false) { $id = $this->session->userdata("\x69\144"); } goto d23QR; d23QR: $var = $this->get_user_var($key, $id); goto ygY73; MuFh1: return $d; goto Jbu9r; Jbu9r: } public function unset_user_vars($id) { $d = $this->mydb->delete($this->uvar, array("\x75\163\145\162\137\x69\x64" => $id)); return $d; } public function get_sys_vars() { goto duJD7; dlWLx: return $d; goto t4GVW; duJD7: $d["\145\162\x72\x6f\x72"] = true; goto mRXLg; mRXLg: $vars = $this->mydb->gets($this->sysvar, array("\x60\153\x65\171\140", "\x76\141\x6c\165\x65")); goto SuyeW; SuyeW: if (!empty($vars)) { goto t_kmi; jUZm1: $d["\144\141\x74\x61"] = $data; goto OsVK2; kcgy0: foreach ($vars as $v) { $data[$v->key] = $v->value; } goto jUZm1; rZRfz: $data = array(); goto kcgy0; t_kmi: $d["\145\162\x72\x6f\x72"] = false; goto rZRfz; OsVK2: } goto dlWLx; t4GVW: } public function get_sys_var($key) { goto BIhfU; o5qrS: if (!empty($var)) { $d = $var->value; } goto bOY3h; DvDbl: $var = $this->mydb->get($this->sysvar, array("\x76\141\x6c\165\x65"), array("\x60\153\145\x79\140" => $key)); goto o5qrS; bOY3h: return $d; goto CdabY; BIhfU: $d = false; goto DvDbl; CdabY: } public function set_sys_var($key, $value = '') { goto eqA_4; mrG8k: return $d; goto QNAX8; KFIoQ: if (!empty($res)) { $this->mydb->update($this->sysvar, array("\x76\x61\154\165\145" => $value), array("\x69\144" => $res->id)); $d = $res->id; } else { $d = $this->mydb->set($this->sysvar, array("\x6b\145\x79" => $key, "\166\141\154\x75\x65" => $value)); } goto mrG8k; JkScY: $res = $this->mydb->get($this->sysvar, array("\151\x64"), array("\140\x6b\x65\x79\x60" => $key)); goto KFIoQ; eqA_4: $d = false; goto JkScY; QNAX8: } public function unset_sys_var($key) { goto hSPNB; sLAn9: $var = $this->get_sys_var($key); goto AKT_e; AKT_e: if (!empty($var)) { $d = $this->mydb->delete($this->sysvar, array("\140\x6b\x65\x79\140" => $key)); } goto c8HPd; hSPNB: $d = false; goto sLAn9; c8HPd: return $d; goto k4mZ4; k4mZ4: } public function set_session($u) { goto RTaJi; pvyBL: $this->session->set_userdata($usses); goto uNat8; hlSzc: if (!empty($u->vars)) { foreach ($u->vars as $key => $v) { $usses[$key] = $v; } } goto pvyBL; RTaJi: $usses = array("\x69\x64" => $u->id, "\156\x61\x6d\145" => $u->name, "\145\155\x61\151\154" => $u->email, "\160\x61\163\163" => $u->pass, "\x6e\x6f\x6d" => $u->nom, "\x70\162\145\x6e\x6f\x6d\163" => $u->prenoms, "\x73\145\170\145" => $u->sexe, "\x6c\157\147\x67\x65\x64\151\x6e" => 1); goto hlSzc; uNat8: $this->sethistory("\154\157\147\x69\x6e"); goto II01a; II01a: return $this; goto lRt3R; lRt3R: } public function get_dest($user) { goto C_y3E; Ha0aU: $uhg = $this->group->get_user_groups($user); goto Nn0xQ; FJlnp: return $d; goto Y0eqf; C_y3E: $d = false; goto Ha0aU; Nn0xQ: if (!empty($uhg)) { switch ($uhg->name) { case "\x41\x64\x6d\x69\156\x69\x73\164\x72\x61\x74\x65\x75\162": $d = "\x61\144\x6d\151\156"; break; case "\104\151\x72\x65\143\x74\x65\x75\x72": $d = "\144\151\x72\x65\143\x74\151\157\156"; break; case "\103\145\x6e\163\145\165\162": $d = "\x63\x65\x6e\163\x65\165\x72"; break; case "\x45\x6e\163\x65\151\x67\156\141\x6e\164": $d = "\160\162\x6f\x66"; break; case "\x53\x75\162\166\145\x69\x6c\154\141\x6e\164": $d = "\163\165\162\x76\145\x69\154\x6c\141\x6e\x74"; break; case "\x53\x65\143\x72\xc3\xa9\x74\141\x69\x72\x65": $d = "\x6d\x61\x69\156"; break; case "\103\157\x6d\160\164\x61\142\154\145": $d = "\143\x6f\155\160\x74\141\142\154\x65"; break; default: $d = "\x6d\141\x69\x6e"; break; } } else { $d = false; } goto FJlnp; Y0eqf: } public function get_session_var($key) { goto SnJfE; JHxw6: return $d; goto DtKhp; d4zuu: $var = $this->session->userdata($key); goto ZSUwV; ZSUwV: if (!empty($var)) { $d = $var; } goto JHxw6; SnJfE: $d = false; goto d4zuu; DtKhp: } public function set_session_var($key, $value) { $data = array($key => $value); $this->session->set_userdata($data); } public function unset_session_var($key) { $this->session->unset_userdata($key); } }
